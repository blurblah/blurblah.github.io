---
title: "덕만이 잠든 시간에 - ESXi RDM 설정"
date: "2016-01-10"
categories: 
  - "server"
tags: 
  - "esxi"
  - "rdm"
---

ESXi는 가상화 솔루션이기 때문에 HDD, SSD 등을 사용하기 위해 storage 등록을 선행해야 한다.

Disk를 100GB, 200GB 정도로 만든다면 크게 문제될게 없겠지만 대용량 disk를 통째로 한가지 용도로 등록해서 사용할거라면 storage 등록 과정에 소요되는 시간이 부담스러워질 수 밖에 없다.

내 경우 700GB 정도를 추가 등록하는데 약 3시간 정도가 필요했다.

#### 1. RDM

RDM (Raw Device Mapping)은 여러가지 용도로 나온 기술(?) 이겠지만 위와 같은 경우 소요시간만 보더라도 충분히 유용하게 사용할 수 있다.

직접 storage 등록하는 경우 시간이 많이 소요되는 이유가 VMWare 가상화 환경에서 사용할 수 있는 파일시스템 (vmfs)으로 만들기 때문인 것으로 보이는데 RDM을 사용할 경우 디스크 전체 혹은 일부를 vmfs로 만들지 않아도 된다.

과정이 잘 설명된 이 [문서](https://www.2cpu.co.kr/bbs/board.php?bo_table=vm&wr_id=23)에 기술된 것처럼 raw disk를 가리키는 vmdk 파일을 하나 생성하는 것으로 끝낼 수 있다. (얼마 걸리지 않는다)

#### 2. 제한사항

처음에는 사용중이던 disk (파일들이 있는)를 그대로 활용할 수 있을것이라 생각했는데 불가능했다.

사용중이던 disk는 파티션이 하나 이상 생성되어 있는 상태인데 파티션이 있는 상태에서 파티션을 대상으로 rdm 설정을 하려고 vmkfstools를 실행하면 오류가 발생한다.

그렇다고 파티션을 무시하고 디스크 자체에 대해서 vmkfstools를 실행하면 파티션을 초기화해버릴까봐 진행해보진 않았다.

#### 3\. 결론

RDM은 그냥 새 disk 하나 추가할 때 사용하자.

그 때 partition이 있는 상태에서 물리 디스크를 대상으로 RDM 설정하면 어떻게 되는지 시도해볼 예정.
