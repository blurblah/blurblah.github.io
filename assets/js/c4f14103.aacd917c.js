"use strict";(self.webpackChunkblurblah_github_io=self.webpackChunkblurblah_github_io||[]).push([[3251],{77385:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var a=s(74848),l=s(28453);const r={title:"MySQL replication\uc744 \ud574\ubcf4\uc790 \u2013 \ub85c\ub4dc\ubc38\ub7f0\uc2f1",date:"2017-02-08",categories:["devops"],tags:["ansible","ansible-role","haproxy","mysql-load-balancing","mysql-\ub85c\ub4dc\ubc38\ub7f0\uc2f1"]},t=void 0,o={permalink:"/2017/02/08/wp/mysql-replication\uc744-\ud574\ubcf4\uc790-\ub85c\ub4dc\ubc38\ub7f0\uc2f1",source:"@site/blog/wp/2017-02-08-mysql-replication\uc744-\ud574\ubcf4\uc790-\ub85c\ub4dc\ubc38\ub7f0\uc2f1.md",title:"MySQL replication\uc744 \ud574\ubcf4\uc790 \u2013 \ub85c\ub4dc\ubc38\ub7f0\uc2f1",description:"\uc9c0\ub09c\ubc88\uc5d0 \uc774\uc5b4\uc11c \uad6c\ucd95\ud55c MySQL slave 2\uac1c\ub97c \ub85c\ub4dc\ubc38\ub7f0\uc2f1 \ud574\ubcf4\uae30\ub85c \ud588\ub2e4. \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub85c \uac00\uc6a9\ud55c\uac8c \uba87\uac00\uc9c0 \uc788\uc9c0\ub9cc \uadf8 \uc911 HAProxy\ub97c \uc774\uc6a9\ud574\uc11c \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc740 \ubaa8\uc591\uc73c\ub85c \ub9cc\ub4e4 \uc0dd\uac01\uc774\ub2e4. LB\uc758 IP\ub294 192.168.100.53 \uc774\uace0 \ub85c\ub4dc\ubc38\ub7f0\uc2f1 \ub300\uc0c1\uc740 \uac01\uac01 192.168.100.51, 192.168.100.50",date:"2017-02-08T00:00:00.000Z",formattedDate:"February 8, 2017",tags:[{label:"ansible",permalink:"/tags/ansible"},{label:"ansible-role",permalink:"/tags/ansible-role"},{label:"haproxy",permalink:"/tags/haproxy"},{label:"mysql-load-balancing",permalink:"/tags/mysql-load-balancing"},{label:"mysql-\ub85c\ub4dc\ubc38\ub7f0\uc2f1",permalink:"/tags/mysql-\ub85c\ub4dc\ubc38\ub7f0\uc2f1"}],readingTime:5.84,hasTruncateMarker:!1,authors:[],frontMatter:{title:"MySQL replication\uc744 \ud574\ubcf4\uc790 \u2013 \ub85c\ub4dc\ubc38\ub7f0\uc2f1",date:"2017-02-08",categories:["devops"],tags:["ansible","ansible-role","haproxy","mysql-load-balancing","mysql-\ub85c\ub4dc\ubc38\ub7f0\uc2f1"]},unlisted:!1,prevItem:{title:"MySQL replication\uc744 \ud574\ubcf4\uc790 - LB \uc774\uc911\ud654",permalink:"/2017/03/06/wp/mysql-replication\uc744-\ud574\ubcf4\uc790-lb-\uc774\uc911\ud654"},nextItem:{title:"MySQL replication\uc744 \ud574\ubcf4\uc790 - \ub450\ubc88\uc9f8",permalink:"/2017/02/06/wp/mysql-replication\uc744-\ud574\ubcf4\uc790-\ub450\ubc88\uc9f8"}},i={authorsImageUrls:[]},c=[{value:"1. Status check\ub97c \uc704\ud55c user \ucd94\uac00",id:"1-status-check\ub97c-\uc704\ud55c-user-\ucd94\uac00",level:4},{value:"2. HAProxy \uc124\uce58\uc640 init script \ub4f1\ub85d",id:"2-haproxy-\uc124\uce58\uc640-init-script-\ub4f1\ub85d",level:4},{value:"3. HAProxy \uc124\uc815\uacfc \ud655\uc778",id:"3-haproxy-\uc124\uc815\uacfc-\ud655\uc778",level:4},{value:"4. \uc790\ub3d9\ud654",id:"4-\uc790\ub3d9\ud654",level:4}];function p(e){const n={a:"a",code:"code",h4:"h4",img:"img",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"http://13.125.231.217/1500",children:"\uc9c0\ub09c\ubc88"}),"\uc5d0 \uc774\uc5b4\uc11c \uad6c\ucd95\ud55c MySQL slave 2\uac1c\ub97c \ub85c\ub4dc\ubc38\ub7f0\uc2f1 \ud574\ubcf4\uae30\ub85c \ud588\ub2e4. \ub85c\ub4dc\ubc38\ub7f0\uc11c\ub85c \uac00\uc6a9\ud55c\uac8c \uba87\uac00\uc9c0 \uc788\uc9c0\ub9cc \uadf8 \uc911 HAProxy\ub97c \uc774\uc6a9\ud574\uc11c \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc740 \ubaa8\uc591\uc73c\ub85c \ub9cc\ub4e4 \uc0dd\uac01\uc774\ub2e4. LB\uc758 IP\ub294 192.168.100.53 \uc774\uace0 \ub85c\ub4dc\ubc38\ub7f0\uc2f1 \ub300\uc0c1\uc740 \uac01\uac01 192.168.100.51, 192.168.100.50"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"http://13.125.231.217/wp-content/uploads/2017/02/db_loadbalancing.png",children:(0,a.jsx)(n.img,{src:s(62832).A+"",width:"462",height:"462"})})}),"\n",(0,a.jsx)(n.p,{children:"\xa0"}),"\n",(0,a.jsx)(n.h4,{id:"1-status-check\ub97c-\uc704\ud55c-user-\ucd94\uac00",children:"1. Status check\ub97c \uc704\ud55c user \ucd94\uac00"}),"\n",(0,a.jsxs)(n.p,{children:["HAProxy\uac00 mysql \uc0c1\ud0dc \ud655\uc778\uc744 \uc704\ud574 \uc811\uadfc\ud558\ub294 \uc0ac\uc6a9\uc790 \uacc4\uc815\uc774 \ucd94\uac00\ub418\uc5b4\uc57c \ud55c\ub2e4. \ub2e4\ub978 \ubc29\uc2dd\uc73c\ub85c status check \ud558\ub294\uac8c \uac00\ub2a5\ud558\ub2e4\uba74 \uc0ac\uc6a9\uc790 \uacc4\uc815\uc774 \ud544\uc694\uc5c6\uc744 \uc218\ub3c4 \uc788\uc73c\ub098\xa0",(0,a.jsx)(n.a,{href:"https://cbonte.github.io/haproxy-dconv/configuration-1.4.html#option%20mysql-check",children:"option mysql-check"}),"\uc744 \uc0ac\uc6a9\ud55c\ub2e4\uba74 mysql\uc5d0 \uc0ac\uc6a9\uc790\uac00 \ucd94\uac00\ub418\uc5b4 \uc788\uc5b4\uc57c \ud55c\ub2e4. Master (\uc704 \uadf8\ub9bc\uc5d0\uc11c\ub294 192.168.100.52)\uc5d0\uc11c \uc544\ub798\uc758 \ucffc\ub9ac\ub85c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud55c\ub2e4."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"INSERT INTO mysql.user(host, user) VALUES('192.168.100.53', 'haproxy_check');\nFLUSH PRIVILEGES;\n"})}),"\n",(0,a.jsx)(n.p,{children:"\ub098\uc911\uc5d0\ub294 \ubcc0\uacbd\ub418\uaca0\uc9c0\ub9cc \uc6b0\uc120 haproxy\uac00 \uc124\uce58\ub420 vm\uc758 ip (192.168.100.53)\uc640 \uc784\uc758\uc758 \uc0ac\uc6a9\uc790 \uacc4\uc815 (\uc5ec\uae30\uc11c\ub294 haproxy_check)\uc744 \ub123\uc5b4\ub450\uc5c8\ub2e4. Slave\uc5d0\ub9cc \uc811\uadfc\ud560 \uac70\uc9c0\ub9cc slave\uc5d0 \uc9c1\uc811 insert\ub97c \ud558\uba74 \ub370\uc774\ud130\ub4e4\uc774 \ub2ec\ub77c\uc9c0\uac8c \ub418\ubbc0\ub85c master\uc5d0\ub9cc \uc9d1\uc5b4\ub123\ub294\ub2e4. \uadf8\ub807\uac8c\ud574\ub3c4 \uc774\ubbf8 \uac80\ud1a0\ud55c\ub300\ub85c slave\uc5d0 \uadf8\ub300\ub85c replication \ub420 \uac83\uc774\ub2e4."}),"\n",(0,a.jsx)(n.p,{children:"\xa0"}),"\n",(0,a.jsx)(n.h4,{id:"2-haproxy-\uc124\uce58\uc640-init-script-\ub4f1\ub85d",children:"2. HAProxy \uc124\uce58\uc640 init script \ub4f1\ub85d"}),"\n",(0,a.jsx)(n.p,{children:"LB\ub85c \uc0ac\uc6a9\ud560 haproxy\ub97c 192.168.100.53\uc5d0 \uc124\uce58\ud55c\ub2e4. Ubuntu\ub77c\uba74 \uc544\ub798\uc758 command\ub97c \uc2e4\ud589\ud588\uc744 \ub54c 1.4 \ubc84\uc804\uc774 \uc124\uce58\ub41c\ub2e4."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"sudo apt-get install haproxy\n"})}),"\n",(0,a.jsx)(n.p,{children:"\uc124\uce58 \ud6c4\uc5d0 service \uc2dc\uc791\uc744 \ud558\uba74 \ubc18\uc751\uc774 \uc5c6\ub294\ub370 init script\ub85c \ub4f1\ub85d\ud574\uc11c \uad00\ub9ac\ud560\uac70\ub77c\uba74 /etc/default/haproxy\xa0\ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c \uc218\uc815\ud574\uc918\uc57c \ud55c\ub2e4. ENABLED=0\uc73c\ub85c \ub418\uc5b4\uc788\ub294 \ubd80\ubd84\uc758 \uac12\uc744 1\ub85c \ubc14\uafd4\uc8fc\uc790."}),"\n",(0,a.jsx)(n.p,{children:"\xa0"}),"\n",(0,a.jsx)(n.h4,{id:"3-haproxy-\uc124\uc815\uacfc-\ud655\uc778",children:"3. HAProxy \uc124\uc815\uacfc \ud655\uc778"}),"\n",(0,a.jsx)(n.p,{children:"HAProxy\uc758 \uc124\uc815\ud30c\uc77c\uc778 /etc/haproxy/haproxy.cfg\uac00 \uae30\ubcf8\uac12\uc73c\ub85c \uadf8\ub300\ub85c \uc788\uae30 \ub54c\ubb38\uc5d0 /etc/default/haproxy\xa0\ud30c\uc77c\uc744 \uc218\uc815\ud588\ub354\ub77c\ub3c4 \uc2dc\uc791\ud560 \uc218 \uc5c6\ub2e4. (listen \ud56d\ubaa9\uc774 \uc5c6\uc74c) /etc/haproxy/haproxy.cfg \ud30c\uc77c \ud558\ub2e8\uc5d0 \uc544\ub798\uc640 \uac19\uc740 \ud615\ud0dc\ub85c \uc0c1\ud0dc \ud655\uc778\ud560 mysql\xa0\uc815\ubcf4\uc640 \ud655\uc778 \ubc29\ubc95 \ub4f1\uc744 \ub123\uc5b4\uc900\ub2e4."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"listen mysql-slaves\n    bind *:3306\n    mode tcp\n    option mysql-check user haproxy_check\n    balance roundrobin\n    server mysql1 192.168.100.51:3306 check\n    server mysql2 192.168.100.50:3306 check\n"})}),"\n",(0,a.jsx)(n.p,{children:"tcp\xa0\ubaa8\ub4dc\ub85c haproxy_check\ub77c\ub294 \uacc4\uc815\uc744 \uc774\uc6a9\ud574 mysql1, mysql2\uc758 \uc0c1\ud0dc\ub97c \ud655\uc778\ud558\uace0 round robin \ubc29\uc2dd\uc73c\ub85c \ub85c\ub4dc\ubc38\ub7f0\uc2f1\uc744 \ud558\ub294\ub370 haproxy\ub294 3306 \ud3ec\ud2b8\ub85c \ubc14\uc778\ub529\ud55c\ub2e4\ub294 \ub0b4\uc6a9\uc774 \ub418\uaca0\ub2e4. \uc774\ub7f0 \ud615\ud0dc\ub85c haproxy \uc124\uc815\ud30c\uc77c\uc744 \uc218\uc815\ud55c \ud6c4\uc5d0 \uae30\ubcf8\uc73c\ub85c \ub4e4\uc5b4\uc788\ub294 defaults\uc758 option httplog, option dontlognull \ud56d\ubaa9\uc740 \uc9c0\uc6cc\uc900\ub2e4. \uc5ec\uae30\uc11c\ub294 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \ub0b4\uc6a9\uc774\ub77c \ud3ec\ud568\ub41c \uc0c1\ud0dc\ub85c \uc11c\ube44\uc2a4\ub97c \uc2dc\uc791\ud560 \uacbd\uc6b0 warning \uba54\uc138\uc9c0\uac00 \ub728\uae30 \ub54c\ubb38. \uc5ec\uae30\uae4c\uc9c0 \uc9c4\ud589\ud558\uace0 \uc544\ub798\uc758 command\ub85c \uc11c\ube44\uc2a4\ub97c \uc2dc\uc791\ud558\uba74 \ub05d\uc774\ub2e4. \uac04\ub2e8\ud558\ub2e4."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"sudo service haproxy start\n"})}),"\n",(0,a.jsx)(n.p,{children:"\uc774\uc81c \ub85c\ub4dc\ubc38\ub7f0\uc2f1\uc774 \ub418\ub294\uc9c0\ub97c \ud655\uc778\ud560 \ucc28\ub840\uc778\ub370 mysql master, slave \ubaa8\ub450 \uace0\uc720\uc758 server_id\ub97c \uac00\uc9c0\uace0 \uc788\uc73c\ubbc0\ub85c \uac04\ub2e8\ud788 server_id\ub97c \ucffc\ub9ac\ud574\ubcf4\uba74 \uc544\ub798\uc758 \uadf8\ub9bc\ucc98\ub7fc \ub9e4\ubc88 2\uc640 3\uc73c\ub85c \ubc88\uac08\uc544 \ubc14\ub00c\ub294 \uac78 \ubcfc \uc218 \uc788\ub2e4."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"http://13.125.231.217/wp-content/uploads/2017/02/db_roundrobin.png",children:(0,a.jsx)(n.img,{src:s(86761).A+"",width:"697",height:"585"})}),"\uc5ec\uae30\uc5d0 weight \uac19\uc740 \uac83\uc744 \uc8fc\uba74 slave \uac01\uac01\uc5d0 \uc5f0\uacb0\ub418\ub294 \ube48\ub3c4\uac00 \ub2ec\ub77c\uc9c0\uac8c \ub418\uaca0\uc9c0\ub9cc \uc5ec\uae30\uae4c\uc9c0 \ud655\uc778\ud558\uace0, slave \ud558\ub098\uac00 \uc8fd\uc5c8\uc744 \uacbd\uc6b0\ub97c \uac00\uc815\ud574\ubcf4\uae30\ub85c \ud588\ub2e4. Slave #2\uc5d0 \uc811\uadfc\ud574\uc11c mysql service\ub97c \uc911\uc9c0\uc2dc\ud0a4\uace0\ub098\uc11c \ub2e4\uc2dc \ucffc\ub9ac\ub97c \ub0a0\ub9ac\uba74 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc \ud55c\ucabd\uc73c\ub85c\ub9cc \uc5f0\uacb0\ub418\ub294 \uac78 \ubcfc \uc218 \uc788\ub2e4. (HAProxy\uac00 \uc0c1\ud0dc \uac80\uc0ac\ud558\ub294 \ub0b4\uc6a9\uc740 haproxy \ub85c\uadf8\ub098 syslog\uc5d0\uc11c\ub3c4 \ud655\uc778 \uac00\ub2a5)"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"http://13.125.231.217/wp-content/uploads/2017/02/db_stopped_instance.png",children:(0,a.jsx)(n.img,{src:s(21442).A+"",width:"697",height:"585"})})}),"\n",(0,a.jsx)(n.p,{children:"\xa0"}),"\n",(0,a.jsx)(n.h4,{id:"4-\uc790\ub3d9\ud654",children:"4. \uc790\ub3d9\ud654"}),"\n",(0,a.jsxs)(n.p,{children:["\uacc4\uc18d \uc0ac\uc6a9\ud574\ubcf4\uace0 \uc788\ub294 ansible\ub85c \uc704 \uacfc\uc815\uc744 \uc790\ub3d9\ud654\ud574\ubcf4\uae30\ub85c \ud588\ub2e4. ",(0,a.jsx)(n.a,{href:"https://github.com/blurblah/ansible-role-mysql-lb",children:"Github"}),"\uc5d0 \uc704\uc758 \ub0b4\uc6a9\uc73c\ub85c \uac04\ub2e8\ud788 role\uc744 \uc815\uc758\ud55c \ub0b4\uc6a9\uc744 \ub123\uc5b4\ub450\uc5c8\ub294\ub370 playbook \ud558\uc704\uc5d0 roles\ub97c \ub514\ub809\ud1a0\ub9ac\ub97c \ub9cc\ub4e4\uace0 \uc801\ub2f9\ud55c \uc774\ub984\uc73c\ub85c clone\ud55c \ud6c4\uc5d0 playbook\uc5d0\uc11c \ud638\ucd9c\ud558\ub3c4\ub85d \ud558\uba74 \ub418\uaca0\ub2e4. Playbook\uc744 \ub9cc\ub4e4 \ub54c\uc5d0\ub294 \uc544\ub798\ucc98\ub7fc mysql_instances variable\uc744 \uc815\uc758\ud558\uba74\uc11c slave \uc815\ubcf4(name, host, port)\ub97c \ub123\uc5b4\uc918\uc57c \ud55c\ub2e4."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"---\n- name: Install and configure haproxy for load balancers\n  hosts: maasnode04\n  become: yes\n  roles:\n    - common\n    - role: mysql-lb\n      mysql_instances:\n        - { name: mysql1, host: 192.168.100.51, port: 3306 }\n        - { name: mysql2, host: 192.168.100.50, port: 3306 }\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Role\uc744 \ub9cc\ub4e4\uae30 \uc804\uc5d0 ansible module \uc911\uc5d0 ",(0,a.jsx)(n.a,{href:"http://docs.ansible.com/ansible/haproxy_module.html",children:"haproxy module"}),"\uc774 \uc788\uc5b4\uc11c \uac80\ud1a0\ub97c \ud574\ubd24\ub294\ub370 \uc774\ubbf8 \uc874\uc7ac\ud558\ub294 haproxy\uc758 backend\uc5d0 \ud2b9\uc815 host\ub97c enable, disable \ud558\ub294 \uc815\ub3c4\uc758 \uae30\ub2a5\ub9cc \uc218\ud589\ud558\ub3c4\ub85d \ub418\uc5b4\uc788\ub294 \uac83 \uac19\uc558\ub2e4. listen \ud56d\ubaa9\uc744 \ucd94\uac00\ud558\uac70\ub098 \ucd08\uae30 \uc124\uc815, \ub610 \uc0c1\uc138\ud55c \uc124\uc815\uc740 \uc548\ub418\ub294 \uac78\ub85c \ubcf4\uc5ec\uc11c \uadf8\ub0e5 template\uc744 \ub9cc\ub4e4\uc5b4\uc11c \uc785\ub825\ub418\ub294 variable\ub85c \ub0b4\uc6a9\uc744 \ucc44\uc6b0\ub3c4\ub85d \uad6c\uc131."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},62832:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/db_loadbalancing-f9328396a4e1005326d1f503cbef7dd7.png"},86761:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/db_roundrobin-d4b325b6aa5e76140f624f16ccaa23ec.png"},21442:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/db_stopped_instance-59b07a39332aa9d6820646a2a2615aa8.png"},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var a=s(96540);const l={},r=a.createContext(l);function t(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);