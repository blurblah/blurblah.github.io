"use strict";(self.webpackChunkblurblah_github_io=self.webpackChunkblurblah_github_io||[]).push([[58126],{81801:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>t});var r=n(74848),c=n(28453);const o={title:"Deploy Cloud Foundry and Diego to AWS",date:"2017-08-06",categories:["devops"],tags:["aws","cf","cf-deploy","cf-\ubc30\ud3ec","cloud-foundry","diego","\ud074\ub77c\uc6b0\ub4dc-\ud30c\uc6b4\ub4dc\ub9ac"],coverImage:"cf-09-cf-apps.png"},l=void 0,i={permalink:"/2017/08/06/wp/deploy-cloud-foundry-and-diego-to-aws",source:"@site/blog/wp/2017-08-06-deploy-cloud-foundry-and-diego-to-aws.md",title:"Deploy Cloud Foundry and Diego to AWS",description:"\ub2e4 \uc815\ub9ac\ud558\uace0\ubcf4\ub2c8 CF \ubc30\ud3ec\ub294 \uac01 component \ub4e4\uc758 \uae30\ub2a5\uc774\ub098 \uc815\uc758, component \uc0ac\uc774\uc758 \uad00\uacc4\uc640 manifest\uc758 \uc124\uc815\ub0b4\uc6a9\uc744 \uc138\uc138\ud558\uac8c \uc54c\uc544\uc57c\ub9cc \ud558\ub294 \uac83\uc774 \uc544\ub2cc\uac00\ub77c\ub294 \uc0dd\uac01\uc774 \ub4e0\ub2e4.",date:"2017-08-06T00:00:00.000Z",formattedDate:"August 6, 2017",tags:[{label:"aws",permalink:"/tags/aws"},{label:"cf",permalink:"/tags/cf"},{label:"cf-deploy",permalink:"/tags/cf-deploy"},{label:"cf-\ubc30\ud3ec",permalink:"/tags/cf-\ubc30\ud3ec"},{label:"cloud-foundry",permalink:"/tags/cloud-foundry"},{label:"diego",permalink:"/tags/diego"},{label:"\ud074\ub77c\uc6b0\ub4dc-\ud30c\uc6b4\ub4dc\ub9ac",permalink:"/tags/\ud074\ub77c\uc6b0\ub4dc-\ud30c\uc6b4\ub4dc\ub9ac"}],readingTime:27.35,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Deploy Cloud Foundry and Diego to AWS",date:"2017-08-06",categories:["devops"],tags:["aws","cf","cf-deploy","cf-\ubc30\ud3ec","cloud-foundry","diego","\ud074\ub77c\uc6b0\ub4dc-\ud30c\uc6b4\ub4dc\ub9ac"],coverImage:"cf-09-cf-apps.png"},unlisted:!1,prevItem:{title:"\uc7a5\uc560\ub85c \uc0b4\ud3b4\ubcf8 AWS EFS performance issue?",permalink:"/2017/08/08/wp/\uc7a5\uc560\ub85c-\uc0b4\ud3b4\ubcf8-aws-efs-performance-issue"},nextItem:{title:"MySQL replication\uc744 \ud574\ubcf4\uc790 - LB \uc774\uc911\ud654",permalink:"/2017/03/06/wp/mysql-replication\uc744-\ud574\ubcf4\uc790-lb-\uc774\uc911\ud654"}},d={authorsImageUrls:[]},t=[{value:"1. \ubc30\ud3ec \uc900\ube44",id:"1-\ubc30\ud3ec-\uc900\ube44",level:3},{value:"2. Install dependencies",id:"2-install-dependencies",level:3},{value:"3. Clone repositories",id:"3-clone-repositories",level:3},{value:"4. Domain \ubc1c\uae09 \ubc0f Route53 \uc124\uc815",id:"4-domain-\ubc1c\uae09-\ubc0f-route53-\uc124\uc815",level:3},{value:"5. env \ud30c\uc77c \uc0dd\uc131",id:"5-env-\ud30c\uc77c-\uc0dd\uc131",level:3},{value:"6. IAM user, keypair \uc0dd\uc131",id:"6-iam-user-keypair-\uc0dd\uc131",level:3},{value:"7. Deployment directory setup",id:"7-deployment-directory-setup",level:3},{value:"8. Configuring security",id:"8-configuring-security",level:3},{value:"9. Cloudformation stack \uc0dd\uc131",id:"9-cloudformation-stack-\uc0dd\uc131",level:3},{value:"10. Login to BOSH",id:"10-login-to-bosh",level:3},{value:"11. Deploy CF",id:"11-deploy-cf",level:3},{value:"12. Deploy CF MySQL for Diego",id:"12-deploy-cf-mysql-for-diego",level:3},{value:"13. Deploy Diego",id:"13-deploy-diego",level:3},{value:"14. Install CF cli",id:"14-install-cf-cli",level:3},{value:"15. Deploy sample application",id:"15-deploy-sample-application",level:3},{value:"16. Resources",id:"16-resources",level:3}];function a(e){const s={a:"a",code:"code",h3:"h3",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"\ub2e4 \uc815\ub9ac\ud558\uace0\ubcf4\ub2c8 CF \ubc30\ud3ec\ub294 \uac01 component \ub4e4\uc758 \uae30\ub2a5\uc774\ub098 \uc815\uc758, component \uc0ac\uc774\uc758 \uad00\uacc4\uc640 manifest\uc758 \uc124\uc815\ub0b4\uc6a9\uc744 \uc138\uc138\ud558\uac8c \uc54c\uc544\uc57c\ub9cc \ud558\ub294 \uac83\uc774 \uc544\ub2cc\uac00\ub77c\ub294 \uc0dd\uac01\uc774 \ub4e0\ub2e4."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.p,{children:"Cloud foundry (CF)\ub97c \ubc30\ud3ec\ud574\ubcf4\uba74\uc11c \uc624\ud508\uc18c\uc2a4\ub294 \ubb34\ub8cc\uac00 \uc544\ub2c8\ub77c\ub294 \uac83\uc744 \ub2e4\uc2dc \ub290\ub080\ub2e4. \ubc30\ud3ec \uacfc\uc815\ub3c4 \uc27d\uc9c0 \uc54a\uc740\ub370 \uc6b4\uc601\uc2dc \ubc1c\uc0dd\ud560 \ubb38\uc81c\ub4e4\uae4c\uc9c0 \uace0\ub824\ud558\uba74 \uc624\ub7ab\ub3d9\uc548 \uacf5\uc744 \ub4e4\uc5ec\uc57c\ub9cc \ud560 \uac83 \uac19\ub2e4. \uc624\ud508\uc18c\uc2a4 cf\ub97c \ubc30\ud3ec\ud558\uba74\uc11c \uc5ec\ub7ec\ubc88\uc758 \uc0bd\uc9c8\uc744 \ud558\uac8c \ub41c \uc774\uc720\uac00 \ubb34\uc5c7\uc77c\uae4c\ub97c \uc0dd\uac01\ud574\ubcf4\ub2c8 \ub300\ub7b5 \uc774\ub807\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) \uc0ac\uc6a9\ub418\ub294 BOSH cli\xa0version\uc758 \ud63c\uc7ac"})}),"\n",(0,r.jsx)(s.p,{children:"BOSH cli\ub294 \ud604\uc7ac major version\uc774 v2\uc778\ub370 \uacf5\uc2dd\ubb38\uc11c\uc758 \ud2b9\uc815 \ub9c1\ud06c\uc640 \uc800\uc7a5\uc18c\ubcc4 README\uc5d0 v1 \uae30\uc900\uc73c\ub85c \uc124\uba85\ub418\uc5b4 \uc788\ub294 \uacbd\uc6b0\uac00 \ub9ce\ub2e4. v1, v2\uc758 \uba85\ub839\uc5b4\uac00 \ub2e4\ub974\uae30 \ub54c\ubb38\uc5d0 \ubb38\uc11c\uc5d0 \uae30\uc220\ub41c \ub0b4\uc6a9\uc744 \uc218\ud589\ud558\uae30 \uc704\ud574 \uba85\ub839\uc5b4\ub97c \ube44\uad50\ud574\ubcf4\uace0 \uc801\ud569\ud55c \uba85\ub839\uc73c\ub85c \ubcc0\uacbd\ud574\uc57c \ud588\uace0, \uc5b4\ub5a4 \ubc84\uc804\uc758 cli\ub97c \uc4f0\ub294\uac8c \ub098\uc744\uc9c0 \uace0\ubbfc\ud574\ubcf4\uae30\ub3c4... (\uacb0\uad6d\uc740 v2\ub85c)"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) \uacf5\uc2dd\ubb38\uc11c\uc640 \ub2e4\ub974\uac8c \ub204\ub77d\ub41c \ubd80\ubd84\ub4e4"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc758 \ub9c1\ud06c\uac00 AWS\uc5d0 cf\ub97c \ubc30\ud3ec\ud558\uae30 \uc704\ud55c \uacf5\uc2dd\ubb38\uc11c. \xa0Manifest \ud30c\uc77c\uc744 generation \ud558\uae30 \uc704\ud574 \ub9cc\ub4e4\uc5b4\uc57c \ud558\ub294 stub \ud30c\uc77c \uc124\uc815\ub0b4\uc6a9\uc5d0\ub294 \ud3ec\ud568\ub418\uc5b4 \uc788\uc9c0\ub9cc \ubcf5\uc0ac\ud574\uc11c \uc4f0\ub77c\uace0 \uba85\uc2dc\ub41c stub \ud30c\uc77c(skeleton)\uc5d0\ub294 \ube60\uc838\uc788\uc5b4\uc11c \uadf8\ub0e5 \uc9c4\ud589\ud55c \uc801\uc774 \uc788\uc5c8\ub2e4. \uacb0\uad6d \uc624\ub958\uac00 \uc0dd\uaca8\uc11c \ub2e4\uc2dc \ucc98\uc74c\ubd80\ud130 \uc9c4\ud589\ud588\uc5c8\uace0 \uc77c\ubd80 \uc124\uc815\uc5d0 \ub300\ud55c \uc124\uba85\uc774 \ubd80\uc871\ud574\uc11c \uc5b4\ub5a4 \uac12\uc744 \ub123\uc5b4\uc57c \ud558\ub294\uac74\uc9c0 \ud55c\ucc38\uc744 \ud5e4\ub9e4\uc57c\ub9cc \ud588\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://docs.cloudfoundry.org/deploying/aws/index.html",children:"http://docs.cloudfoundry.org/deploying/aws/index.html"})}),"\n",(0,r.jsxs)(s.p,{children:["\uacb0\uc815\uc801\uc73c\ub85c \uacf5\uc2dd\ubb38\uc11c\uc5d0\ub294 diego \ubc30\ud3ec\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc774 \uc5c6\uc5b4\uc11c \uadf8\ub300\ub85c \ubc30\ud3ec\ud574\ubd10\uc57c application\uc744 \uc62c\ub9ac\uc9c0 \ubabb\ud558\uae30 \ub54c\ubb38\uc5d0 \uacb0\uad6d \ub2e4\ub978 \ubb38\uc11c\ub97c \ucc38\uc870\ud560 \uc218 \ubc16\uc5d0 \uc5c6\uc5c8\ub2e4. (",(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/issues/203",children:"github issue"}),"\ub97c \ucc38\uace0\ud558\ub2c8 cf\ub294 \uadf8\ub300\ub85c \ubc30\ud3ec\ud558\uace0 diego\ub97c default backend\ub85c \uc9c0\uc815\ud574\uc11c \ubc30\ud3ec\ud558\ub77c\ub294\ub370 \ub098\uc911\uc5d0 \uae30\ud68c\uac00 \ub418\uba74 \uc2dc\ub3c4.)"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) \uc800\uc7a5\uc18c \ubb38\uc81c"})}),"\n",(0,r.jsx)(s.p,{children:"\ub300\ubd80\ubd84\uc758 cf \ubc30\ud3ec\ubb38\uc11c\uc5d0\ub294 \uc800\uc7a5\uc18c(\uc608\ub97c \ub4e4\uc5b4, cf-release)\ub97c clone \ud574\uc11c sub module\uc744 \ub2e4 \ub561\uae30\uace0 BOSH cli\uc758 create-release \uba85\ub839\uc73c\ub85c \ube4c\ub4dc\ub97c \ud55c \ud6c4\uc5d0 BOSH director\uc5d0 \uc5c5\ub85c\ub4dc\ud558\ub77c\uace0 \ub418\uc5b4\uc788\uc9c0\ub9cc create-release \uc2dc\uc810\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud55c \uc801\uc774 \uc788\uc5c8\ub2e4. \ub85c\uadf8 \ud655\uc778\ud574\uac00\uba74\uc11c \uc6d0\uc778\uc744 \ucc3e\uc544\ubcf4\ub2c8 \ub9c1\ud06c\uac00 \uae68\uc9c4 \ud2b9\uc815\ud30c\uc77c\uc774 \uadf8\ub300\ub85c \uc800\uc7a5\uc18c\uc5d0 \uc62c\ub77c\uac00 \uc788\uc5c8\uae30 \ub54c\ubb38\uc778\ub370 \uacb0\uad6d local\uc5d0\uc11c release\ub97c \ub9cc\ub4e4\uc9c0 \uc54a\uace0 \uc774\ubbf8 \ub9cc\ub4e4\uc5b4\uc9c4 release\ub97c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \ud574\uacb0."}),"\n",(0,r.jsx)(s.p,{children:"CF\ub97c \ubc30\ud3ec\ud558\uae30 \uc704\ud574\uc11c\ub294 BOSH\ub97c \uc774\uc6a9\ud574\uc57c \ud558\ub294\ub370 BOSH director\ub294 \uad6c\uc131\ubc29\ubc95\uc774 \ub450\uac00\uc9c0\uc778 \uac83\uc73c\ub85c \ubcf4\uc778\ub2e4. \ud558\ub098\ub294 bosh cli (create-env)\ub97c \uc774\uc6a9\ud558\ub294 \uac83\uc774\uace0 \ub450\ubc88\uc9f8\ub294 BOSH bootloader(bbl). \uacf5\uc2dd\ubb38\uc11c \ub300\uc2e0 \ucc3e\uc544\ubcf4\uac8c \ub41c \uc544\ub798\uc758 \ub9c1\ud06c\ub294 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud574\uc11c BOSH director\ub97c \ubc30\ud3ec\ud558\ub3c4\ub85d \ub418\uc5b4\uc788\ub2e4.\xa0AWS cloudformation\uc5d0 stack\uc744 \ub9cc\ub4e4\uc5b4\uc11c \uad00\ub9ac\ud560 \uc218 \uc788\ub3c4\ub85d \ud574\ub454 \uac83 \uac19\uc740\ub370 director \ubc30\ud3ec\ub294 bosh cli\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws",children:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws"})}),"\n",(0,r.jsx)(s.p,{children:"\uc704 \ubb38\uc11c\uc758 \ub0b4\uc6a9\ub3c4 \uc798\ubabb\ub41c \ub0b4\uc6a9\ub4e4\uc774 \uc788\uc9c0\ub9cc \ubc30\ud3ec\uc758 \uacfc\uc815\uc744 \ub2e8\uc21c\ud654\ud558\uba74 \uc544\ub798\ucc98\ub7fc \ub420 \uac83 \uac19\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:"BOSH \ubc30\ud3ec => CF stub \ub9cc\ub4e4\uae30 => Stub\uc73c\ub85c manifest \uc0dd\uc131 => CF \ubc30\ud3ec => Diego\uac00 \uc0ac\uc6a9\ud560 DB \ubc30\ud3ec (stub, manifest \ub9cc\ub4e4\uc5b4\uc11c) => Diego \ubc30\ud3ec (\uc5ed\uc2dc stub, manifest \ub9cc\ub4e4\uc5b4\uc11c)"}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"1-\ubc30\ud3ec-\uc900\ube44",children:"1. \ubc30\ud3ec \uc900\ube44"}),"\n",(0,r.jsxs)(s.p,{children:["BOSH cli \ub4f1\uc744 \uc124\uce58\ud558\uace0 \ubc30\ud3ec\uc640 \uad00\ub828\ub41c \uc791\uc5c5\uc744 \uc218\ud589\ud560 \uc7a5\ube44\ub97c \uc900\ube44\ud558\uace0 \uc9c4\ud589\ud588\ub2e4. \ucc98\uc74c\uc5d4 Ubuntu 16.04\ub85c \uc2dc\uc791\uc744 \ud588\ub294\ub370 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc stemcell upload \ud558\ub294 \ubd80\ubd84\uc5d0\uc11c \uc624\ub958\uac00 \ub098\uc11c \uc6d0\uc778\uc744 \ucc3e\ub2e4\uac00 \uacb0\uad6d 14.04\uc5d0\uc11c \ub2e4\uc2dc \uc9c4\ud589. (\uc774 \uc624\ub958\ub294 ",(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry-incubator/bosh-aws-cpi-release/issues/58",children:"github issue"}),"\ub85c \ub4f1\ub85d\ub418\uc5b4\uc788\uc74c)"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-01-set_api-error.png",children:(0,r.jsx)(s.img,{src:n(15382).A+"",width:"585",height:"439"})})}),"\n",(0,r.jsx)(s.p,{children:"\ud544\uc694\ub85c\ud558\ub294 instance\uc758 \uac2f\uc218\uac00 \ub9ce\uc73c\ubbc0\ub85c (40\uac1c \uc774\uc0c1) \ubc30\ud3ec\ud558\uace0\uc790 \ud558\ub294 region\uc758 ec2 instance limit\uc744 \uc0ac\uc804\uc5d0 \uc62c\ub824\ub450\ub294 \uac83\ub3c4 \ud544\uc694\ud558\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"2-install-dependencies",children:"2. Install dependencies"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws",children:"\ucc38\uc870\ud55c \ubb38\uc11c"}),"\uc5d0 \uba85\uc2dc\ub41c\ub300\ub85c CF\ub97c \ubc30\ud3ec\ud558\uae30 \uc704\ud574 go, godep, boosh, jq, spiff, awscli, bosh cli\xa0(v2) \uac00 \ud544\uc694\ud558\ubbc0\ub85c \uc124\uce58\ud574\uc57c \ud558\ub294\ub370 \ub300\ubd80\ubd84\uc740 apt-get\uc774\ub098 download \uc911 \ud3b8\ud55c \ubc29\ubc95\uc73c\ub85c \ud558\uba74 \ub418\uc9c0\ub9cc jq\uc758 \uacbd\uc6b0 ubuntu 14.04\uc5d0\uc11c\ub294 \uaf2d download \ud574\uc11c 1.5 \ubc84\uc804\uc744 \uc124\uce58\ud574\uc57c\ub9cc \ud55c\ub2e4. jq\xa0\uc124\uce58\uc5d0 apt-get\uc744 \uc774\uc6a9\ud558\uac8c \ub418\uba74 ubuntu 14.04\uc5d0\uc11c\ub294 1.3 \ubc84\uc804\uc774 \uc124\uce58\ub418\ub294\ub370 \ub098\uc911\uc5d0 \ud2b9\uc815 script \uc2e4\ud589\uc2dc 1.3\uc5d0\uc11c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 argument\ub97c \ub118\uae30\uac8c \ub418\uc11c \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uac8c \ub41c\ub2e4. \ubb38\uc11c\uc5d0\ub294 ruby\ub3c4 \uc124\uce58\ud558\ub77c\uace0 \ub418\uc5b4\uc788\uc9c0\ub9cc bosh cli v2\uc758 dependencies\uc5d0 \uba85\uc2dc\ub418\uc5b4 \uc788\uc73c\ubbc0\ub85c bosh cli \uc124\uce58\ud558\uace0 \uc9c4\ud589\ud558\uba74 \ub418\uaca0\ub2e4."]}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"3-clone-repositories",children:"3. Clone repositories"}),"\n",(0,r.jsx)(s.p,{children:"\uc800\uc7a5\uc18c\ub294 \ubaa8\ub450 4\uac1c\uac00 \ud544\uc694\ud558\uc9c0\ub9cc \uba3c\uc800 \ud544\uc694\ud55c 3\uac1c\uc758 \uc800\uc7a5\uc18c\ub9cc clone \ud588\ub2e4. (\ubb38\uc11c\ub300\ub85c) \uadf8\ub9ac\uace0 \uc800\uc7a5\uc18c \ubc0f \uae30\ud0c0 \ud30c\uc77c\ub4e4\uc744 \ubaa8\uc544\ub458 directory (\ub098\uc758 \uacbd\uc6b0\uc5d4 bosh-diego\ub77c\ub294 \uc774\ub984\uc73c\ub85c)\ub97c \uc0dd\uc131\ud558\uace0 \uadf8 \uc704\uc5d0\uc11c \uc791\uc5c5"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"mkdir bosh-diego\ncd bosh-diego\n\ngit clone https://github.com/cloudfoundry/bosh-deployment\ngit clone https://github.com/cloudfoundry/cf-release\ngit clone https://github.com/cloudfoundry/diego-release\n"})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"4-domain-\ubc1c\uae09-\ubc0f-route53-\uc124\uc815",children:"4. Domain \ubc1c\uae09 \ubc0f Route53 \uc124\uc815"}),"\n",(0,r.jsx)(s.p,{children:"\uac1c\ubc1c\uc6a9\uc73c\ub85c cf\ub97c \uad6c\ucd95\ud558\ub294 \ubb38\uc11c\uc5d0\ub294 domain \uc5c6\uc774 xip.io\uc640 elastic ip\ub9cc \uac00\uc9c0\uace0 \uc791\uc5c5\ud558\ub294 \ub0b4\uc6a9\uc774 \uc788\uc5c8\uc9c0\ub9cc \uc5ec\ub7ec\uac00\uc9c0 \uc774\uc720\ub85c domain\uc744 \uc0ac\uc11c route53\uc5d0 zone\uc744 \uc0dd\uc131\ud588\ub2e4. (AWS\uc5d0\uc11c .com \ub3c4\uba54\uc778 \uc0ac\ub2c8 \ud3b8\ud558\ub2e4. 12\ubd88/\ub144)"}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"5-env-\ud30c\uc77c-\uc0dd\uc131",children:"5. env \ud30c\uc77c \uc0dd\uc131"}),"\n",(0,r.jsx)(s.p,{children:"\uc2e4\ud589\ud560 script \ub4e4 \ud638\ucd9c\uc2dc \ud3b8\uc758\ub97c \uc704\ud574 env \ud30c\uc77c\uc744 \uc0dd\uc131\ud558\uace0 source\ub85c load \ud55c\ub2e4. (\uc544\ub798\uc758 \ub0b4\uc6a9\uc740 \uc0c1\ud669\uc5d0 \ub9de\uac8c \uc218\uc815\ud560 \ud544\uc694\uac00 \uc788\uc74c)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'cat <<"EOF" > deployment-env\nexport DEPLOYMENT_DIR="$(cd $(dirname "$BASH_SOURCE[0]") && pwd)"\n\nexport BOSH_DEPLOYMENT_DIR="$HOME/bosh-diego/bosh-deployment"\nexport CF_RELEASE_DIR="$HOME/bosh-diego/cf-release"\nexport DIEGO_RELEASE_DIR="$HOME/bosh-diego/diego-release"\n\nexport CF_DOMAIN="codealley-cf.com"\nexport STACK_NAME="codealley-cf-stack"\nexport gobosh=bosh\n\necho "DEPLOYMENT_DIR set to \'$DEPLOYMENT_DIR\'"\necho "BOSH_DEPLOYMENT_DIR set to \'$BOSH_DEPLOYMENT_DIR\'"\necho "CF_RELEASE_DIR set to \'$CF_RELEASE_DIR\'"\necho "DIEGO_RELEASE_DIR set to \'$DIEGO_RELEASE_DIR\'"\necho "CF_DOMAIN set to \'$CF_DOMAIN\'"\necho "v2 BOSH CLI located at \'$(which "${gobosh}")\'"\nEOF\n\n\nsource deployment-env\n'})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"6-iam-user-keypair-\uc0dd\uc131",children:"6. IAM user, keypair \uc0dd\uc131"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) IAM policy \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"Cloudformation\uc744 \ud3ec\ud568\ud574 aws\uc5d0 \ub300\ud55c \ubaa8\ub4e0 \uc791\uc5c5\uc744 \uc704\ud55c IAM user\ub97c \uc0dd\uc131\ud574\uc57c \ud558\ub294\ub370 \uadf8 user\uc5d0\uac8c \uc9c0\uc815\ud560 policy\ub97c \ub9cc\ub4e4\uc5b4\uc57c \ud55c\ub2e4. \uc544\ub798 \ub9c1\ud06c\ub300\ub85c \uc9c4\ud589\ud558\uba74 \ub41c\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#iam-user-policy",children:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#iam-user-policy"})}),"\n",(0,r.jsx)(s.p,{children:"Policy \ub0b4\uc6a9\uc744 \ubd10\ub3c4 \uc54c\uaca0\uc9c0\ub9cc \uac70\uc758 \ubaa8\ub4e0 \uad8c\ud55c\uc774 \ud544\uc694\ud55c\ub370 \uadf8 \uc911 S3\ub294 cf\uac00 droplet, buildpack \ub4f1\uc744 \uc800\uc7a5\ud558\ub294 blobstore \ub300\uc2e0 \uc0ac\uc6a9\ub418\ub294 \uac83\uc73c\ub85c \ubcf4\uc778\ub2e4. (\uac1c\ubc1c\uc6a9\uc73c\ub85c \uad6c\ucd95\ud588\uc744 \ub54c\uc5d0\ub294 cf \ub0b4\ubd80\uc5d0 blobstore\ub97c \ub450\ub3c4\ub85d \ub418\uc5b4\uc788\uc5c8\uc74c)"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) IAM user \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\uc5ed\uc2dc \uc544\ub798 \ubb38\uc11c\ub300\ub85c user\ub97c \uc0dd\uc131\ud558\uba74 \ub41c\ub2e4. Access type\uc5d0 \ub300\ud55c \uba85\uc2dc\ub294 \ub418\uc5b4\uc788\uc9c0 \uc54a\uc740\ub370 aws\uc5d0\uc11c programmatic access\ub85c \uc120\ud0dd\ud558\uba74 \ub418\uaca0\ub2e4. User \uc0dd\uc131\uc2dc \ub2e4\uc6b4\ub85c\ub4dc \ud560 \uc218 \uc788\ub294 credentials.csv \ud30c\uc77c\uc740 \ub098\uc911\uc5d0 \ud544\uc694\ud558\ubbc0\ub85c \ubbf8\ub9ac \ub2e4\uc6b4\ub85c\ub4dc \ud574\ub454\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#iam-user",children:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#iam-user"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) Keypair \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\ubc30\ud3ec\ud560 region\uc5d0\uc11c keypair\ub97c \ub9cc\ub4e4\uace0\ub098\uc11c \ub2e4\uc6b4\ub85c\ub4dc\ud55c private key\ub97c \uc791\uc5c5\uacbd\ub85c \uc544\ub798\uc758 keypair\xa0directory\uc5d0 id_rsa_bosh\ub780 \uc774\ub984\uc73c\ub85c \ubcf5\uc0ac\ud55c \ud6c4 \uad8c\ud55c\uc744 \uc870\uc815\ud55c\ub2e4. \uc544\ub798 \ub9c1\ud06c \ucc38\uc870"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#aws-keypair-for-the-bosh-director",children:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#aws-keypair-for-the-bosh-director"})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"7-deployment-directory-setup",children:"7. Deployment directory setup"}),"\n",(0,r.jsx)(s.p,{children:"\uc815\ud574\uc9c4 \uad6c\uc870\uc758 directory\ub97c \uba87 \uac1c \uc0dd\uc131\ud55c \ud6c4\uc5d0 key, cert, stub \ub4f1\uc758 \ud30c\uc77c\uc744 \uc0dd\uc131\ud574\uc57c \ud558\ub294\ub370 \uc544\ub798\uc640 \uac19\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) Directory \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $DEPLOYMENT_DIR\nmkdir certs\nmkdir -p ops-files/bosh\nmkdir -p stubs/bosh\nmkdir stubs/infrastructure\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) boostrap env \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"Region\uc744 \uc9c0\uc815\ud558\uace0 IAM user \uc0dd\uc131\uc2dc\uc5d0 \ubc1b\uc544\ub450\uc5c8\ub358 credentials.csv \ud30c\uc77c \ub0b4\ubd80\uc5d0 \uc788\ub294 access key id\uc640 secret access key \uac12\uc744 \uc774\uc6a9\ud574\uc11c \ud30c\uc77c\uc744 \ub9cc\ub4e0\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cat <<EOF > $DEPLOYMENT_DIR/bootstrap_environment\nexport AWS_DEFAULT_REGION=us-east-1\nexport AWS_ACCESS_KEY_ID=\nexport AWS_SECRET_ACCESS_KEY=''\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) ELB\uc6a9 key, cert \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\ubbf8\ub9ac \ubcf4\uc720\ud55c \uc778\uc99d\uc11c\uac00 \uc788\ub2e4\uba74 \uadf8\uac83\uc744 \uc774\uc6a9\ud558\uba74 \ub418\uc9c0\ub9cc \uc5c6\ub2e4\uba74 \uc544\ub798\ucc98\ub7fc self signed \uc778\uc99d\uc11c\ub97c \ub9cc\ub4e0\ub2e4. csr \ud30c\uc77c \uc0dd\uc131\uc2dc common name\uc740 \uac00\uc9c0\uace0 \uc788\ub294 domain\uc758 \uc640\uc77c\ub4dc\uce74\ub4dc\ub85c \uc9c0\uc815\ud574\uc57c \ud55c\ub2e4. (\ub098\uc758 \uacbd\uc6b0\uc5d4 *.codealley-cf.com)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $DEPLOYMENT_DIR/certs\nopenssl genrsa -out elb-cfrouter.key 2048\nopenssl req -new -key elb-cfrouter.key -out elb-cfrouter.csr\nopenssl x509 -req -in elb-cfrouter.csr -signkey elb-cfrouter.key -out elb-cfrouter.pem\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(4) Domain stub \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $DEPLOYMENT_DIR\ncat <<EOF > $DEPLOYMENT_DIR/stubs/domain.yml\n---\ndomain: $CF_DOMAIN\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(5) Instance type stub \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\ubb38\uc11c\uc0c1\uc5d0\ub294 \uc9c0\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 default \uac12\uc73c\ub85c \uc124\uc815\ub41c\ub2e4\ub77c\uace0 \ub418\uc5b4\uc788\uc9c0\ub9cc \ud30c\uc77c \ud639\uc740 \uc77c\ubd80 \ub0b4\uc6a9\uc740 \uaf2d \ud544\uc694\ud55c \uac83 \uac19\ub2e4. (\ud30c\uc77c\uc774 \uc544\uc608 \uc5c6\ub294 \uacbd\uc6b0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc5c8\uc74c) \uc5b4\ub290 \uc815\ub3c4\uc758 \ud06c\uae30\uac00 \ub418\uc5b4\uc57c\ud558\ub294\uc9c0 \uc54c \uc218 \uc5c6\uc5b4\uc11c \uadf8\ub0e5 \ub9cc\ub9cc\ud55c m3.medium\uc73c\ub85c \uc9c0\uc815\ud574\ubd24\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cat <<EOF > $DEPLOYMENT_DIR/stubs/aws-instance-types.yml\ninstance_types:\n  database: m3.medium\n  mysql_database: m3.medium\n  mysql_proxy: m3.medium\n  mysql_persistent_disk_type: gp2\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(6) AZ stub \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\ucc98\ub7fc \ud30c\uc77c\uc5d0 \uc9c0\uc815\ud55c availability zone\uc5d0 vm \uc0dd\uc131\uc744 \ud558\uba74\uc11c \uc774\uc911\ud654 \uad6c\uc131\uc744 \ud558\ub294 \uac83\uc73c\ub85c \ubcf4\uc778\ub2e4. \uc77c\ubd80 availability zone\uc5d0\uc11c \ud2b9\uc815 type\uc758 instance\uac00 \uc0dd\uc131\ub418\uc9c0 \ubabb\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\uc5c8\uae30 \ub54c\ubb38\uc5d0 (\ub098\uc758 \uacbd\uc6b0\uc5d4 us-east-1b\uc5d0\uc11c m3.medium \uc0dd\uc131 \ubd88\uac00. \uba54\uc138\uc9c0 \uc0c1\uc73c\ub85c\ub294 aws\uc5d0 \uc5b4\ub5a4 limit\uc774 \uac78\ub824\uc788\uc5c8\ub358 \uac83\uc73c\ub85c \ubcf4\uc784) \ud544\uc694\ud55c\uacbd\uc6b0 \uc870\uc815\uc744 \ud574\uc57c\ud55c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cat <<EOF > $DEPLOYMENT_DIR/stubs/infrastructure/availability_zones.yml\n---\nmeta:\n  availability_zones:\n  - us-east-1a\n  - us-east-1c\n  - us-east-1d\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(7) BOSH vars \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"default_key_name\uc740 AWS\uc5d0\uc11c \uc0dd\uc131\ud55c keypair\uc758 \uc774\ub984\uc744 \uc9c0\uc815\ud558\uace0 director_name\uc740 \uc785\ub9db\ub300\ub85c \uc124\uc815\ud55c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cat <<EOF > $DEPLOYMENT_DIR/stubs/bosh/vars.yml\n---\ndefault_key_name: bosh-diego-keypair\ndirector_name: codealley-bosh\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(8) BOSH domain stub \uc0dd\uc131 (Optional)"})}),"\n",(0,r.jsx)(s.p,{children:"Domain\ub3c4 \uc0c0\uaca0\ub2e4 \ud3b8\uc758\ub97c \uc704\ud574\uc11c bosh\uc6a9 sub domain\uc744 \uc9c0\uc815\ud588\ub2e4. \uc544\uc9c1 bosh (bosh director)\uc0dd\uc131 \uc804\uc774\uc9c0\ub9cc \ud544\uc694\ud558\ub2e4\uba74 \uc774\ub807\uac8c\ub9cc \uc9c0\uc815\ud558\uace0 \ub098\uc911\uc5d0 director \uc0dd\uc131 \ud6c4\uc5d0 \uc2e4\uc81c domain record\ub97c \ucd94\uac00\ud558\uba74 \ub41c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cat <<EOF > $DEPLOYMENT_DIR/stubs/bosh/domain.yml\n---\ndirector_domain: bosh.codealley-cf.com\nEOF\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(9) \uae30\ud0c0"})}),"\n",(0,r.jsx)(s.p,{children:"\ubb38\uc11c\uc0c1\uc5d0 \uae30\uc220\ub41c \ub0b4\uc6a9 \uc911 \ub098\uba38\uc9c0\ub294 optional\uc774\ub77c \uc124\uc815\ud558\uc9c0 \uc54a\uc558\uc74c"}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"8-configuring-security",children:"8. Configuring security"}),"\n",(0,r.jsx)(s.p,{children:"\uc774 \ubd80\ubd84\uc740 cf\ub97c \uad6c\uc131\ud558\ub294 \uac01 component \ub4e4\ub07c\ub9ac ssl\ub85c \ud1b5\uc2e0\ud558\uae30 \uc704\ud55c \uc778\uc99d\uc11c\uc640 key\ub97c \uc0dd\uc131\ud558\ub294 \ub0b4\uc6a9\uc73c\ub85c \ub300\ubd80\ubd84 \uc800\uc7a5\uc18c\uc5d0 \uc900\ube44\ub418\uc5b4 \uc788\ub294 script\ub97c \uc2e4\ud589\ud558\ub294 \uac83\uc73c\ub85c \uc644\ub8cc\ud560 \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) Consul\uacfc cloud controller(cc)\uc6a9 certs \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $DEPLOYMENT_DIR/certs\n$CF_RELEASE_DIR/scripts/generate-cf-diego-certs\n$CF_RELEASE_DIR/scripts/generate-consul-certs\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) UAA\uc6a9 certs\uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"UAA\ub294 cf\uc5d0\uc11c user \uc778\uc99d\uc744 \ub2f4\ub2f9\ud558\ub294 component"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"pushd $CF_RELEASE_DIR\n./scripts/generate-uaa-certs\nmv uaa-certs/ $DEPLOYMENT_DIR/certs/\npopd\npushd $DIEGO_RELEASE_DIR\n./scripts/generate-uaa-saml-certs\nmv diego-certs/uaa-saml-certs/saml.* $DEPLOYMENT_DIR/certs/uaa-certs\npopd\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) Loggregator certs \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"$CF_RELEASE_DIR/scripts/generate-loggregator-certs \\\n  $DEPLOYMENT_DIR/certs/cf-diego-certs/cf-diego-ca.crt \\\n  $DEPLOYMENT_DIR/certs/cf-diego-certs/cf-diego-ca.key\npushd $CF_RELEASE_DIR\n$CF_RELEASE_DIR/scripts/generate-statsd-injector-certs \\\n  $DEPLOYMENT_DIR/certs/loggregator-certs/loggregator-ca.crt \\\n  $DEPLOYMENT_DIR/certs/loggregator-certs/loggregator-ca.key\nmv $CF_RELEASE_DIR/statsd-injector-certs $DEPLOYMENT_DIR/certs\npopd\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(4) Diego\uc5d0 \uc0ac\uc6a9\ub420 certs \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"$DIEGO_RELEASE_DIR/scripts/generate-diego-certs $DEPLOYMENT_DIR/certs/cf-diego-certs\nmv $DIEGO_RELEASE_DIR/diego-certs/* $DEPLOYMENT_DIR/certs\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(5) SSH \uc811\uadfc\uc744 \uc704\ud55c host key \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"Passphrase\ub97c \ubb3c\uc5b4\ubcf4\uba74 \uacf5\ubc31\uc73c\ub85c \ub123\uc5b4\uc57c \ud55c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"ssh-keygen -f $DEPLOYMENT_DIR/keypair/ssh-proxy-host-key.pem\nssh-keygen -lf $DEPLOYMENT_DIR/keypair/ssh-proxy-host-key.pem.pub | cut -d ' ' -f2 \\\n  > $DEPLOYMENT_DIR/keypair/ssh-proxy-host-key-fingerprint\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(6) UAA\uc6a9 keypair \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\uc5ed\uc2dc \uc774\uac83\ub3c4 passphrase\ub294 \uacf5\ubc31"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"ssh-keygen -t rsa -b 4096 -f $DEPLOYMENT_DIR/keypair/uaa\nopenssl rsa -in $DEPLOYMENT_DIR/keypair/uaa -pubout > $DEPLOYMENT_DIR/keypair/uaa.pub\n"})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"9-cloudformation-stack-\uc0dd\uc131",children:"9. Cloudformation stack \uc0dd\uc131"}),"\n",(0,r.jsx)(s.p,{children:"\uc774 \uacfc\uc815\uc740 aws\uc5d0\uc11c cloudformation stack\uc744 \uc0dd\uc131\ud558\uace0 stack\uc5d0 \ud3ec\ud568\ub420\xa0vpc, s3 bucket \ub4f1\uc774 \uc790\ub3d9 \uc0dd\uc131\ub418\uba70 BOSH director\uc640 NAT\uc6a9 vm\uc774 \ub9cc\ub4e4\uc5b4\uc9c0\ub294 \uacfc\uc815\uc774\ub2e4. \ub2e8\uc21c\ud788 script\ub9cc \ud638\ucd9c\ud574\uc8fc\uba74 \ub41c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'cd $DIEGO_RELEASE_DIR/examples/aws\n./deploy_aws_environment create-stack deploy-bosh "$BOSH_DEPLOYMENT_DIR" "$DEPLOYMENT_DIR" "$STACK_NAME"\n'})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"10-login-to-bosh",children:"10. Login to BOSH"}),"\n",(0,r.jsx)(s.p,{children:"9\ubc88 \uacfc\uc815\uc5d0\uc11c bosh director\uac00 \ubc30\ud3ec\ub418\uc5c8\uae30 \ub54c\ubb38\uc5d0 bosh director\uc758 IP (elastic ip\uac00 \ud560\ub2f9\ub428)\ub97c \ud655\uc778\ud574 route53\uc5d0 record\ub97c \ucd94\uac00\ud55c\ub2e4. (\ub9cc\uc57d \uc704\uc5d0\uc11c bosh director\uc5d0 \ub300\ud55c domain \uc124\uc815\uc744 \ud558\uc9c0 \uc54a\uc558\ub2e4\uba74 \uc544\ub798 command\uc5d0\uc11c domain \ub300\uc2e0 ip\ub97c \uc774\uc6a9) \uc774\ud6c4 cf \ub4f1\uc744 bosh\ub85c \ubc30\ud3ec\ud558\uae30 \uc704\ud574 \ub85c\uadf8\uc778\uc744 \ud574\uc57c\ud55c\ub2e4. BOSH cli v1\uc5d0\uc11c\ub294 target \uc9c0\uc815\ud558\ub294 \ub0b4\uc6a9\uc774\uc5c8\ub294\ub370 v2\uc5d0\uc11c\ub294 alias\ub85c \uc9c0\uc815\ud558\ub294 \uba85\uce6d\uc744 \uc774\ud6c4\uc5d0 \uacc4\uc18d bosh cli \uc2e4\ud589\uc2dc\ub9c8\ub2e4 \ud568\uaed8 \ub123\uc5b4\uc918\uc57c \ud574\ub2f9 director\uc5d0 \uba85\ub839\uc744 \ub0b4\ub9b4 \uc218 \uc788\ub3c4\ub85d \ub418\uc5b4\uc788\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh alias-env ca-bosh -e bosh.codealley-cf.com \\\n  --ca-cert <(bosh int $DEPLOYMENT_DIR/deployments/bosh/creds.yml --path /director_ssl/ca)\nbosh -e ca-bosh log-in\n"})}),"\n",(0,r.jsx)(s.p,{children:"Login\uc2dc \uc0ac\uc6a9\ub418\ub294 \uacc4\uc815\uc740 \uc6b0\uc120 admin\uc73c\ub85c password\ub294\xa0$DEPLOYMENT_DIR/deployments/bosh/creds.yml \ud30c\uc77c\uc744 \uc5f4\uc5b4\ubcf4\uba74 \uc790\ub3d9 \uc0dd\uc131\ub41c \uac12\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ucd94\uac00\ub85c \uc6d0\ub798 \uc774\uc804 \uacfc\uc815 \uc911 director\uc758 uuid\ub97c \ud655\uc778\ud574\uc11c \uc790\ub3d9\uc73c\ub85c director-uuid.yml \ud30c\uc77c\uc5d0 uuid \uac12\uc744 \ub123\ub3c4\ub85d \ub418\uc5b4\uc788\ub294 \uac83 \uac19\uc740\ub370 \uc81c\ub300\ub85c \ub3d9\uc791\ud558\uc9c0 \uc54a\uc558\ub2e4\uba74 \uc544\ub798 \uba85\ub839\uc73c\ub85c uuid\ub97c \ud655\uc778\ud574 \uac12\uc744 \ucc44\uc6cc\uc900\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"# Check director uuid\nbosh -e ca-bosh env\n# Insert uuid value if empty\nvi $DEPLOYMENT_DIR/stubs/director-uuid.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"11-deploy-cf",children:"11. Deploy CF"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) CF properties stub \uc218\uc815"})}),"\n",(0,r.jsx)(s.p,{children:"\uc704 \uacfc\uc815\uae4c\uc9c0 \ubb38\uc81c\uac00 \uc5c6\uc5c8\ub2e4\uba74 $DEPLOYMENT_DIR/stubs/cf/properties.yml \ud30c\uc77c\uc774 \uc790\ub3d9\uc0dd\uc131 \ub418\uc5b4\uc788\ub294\ub370 \uc774 \ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c REPLACE_WITH_ \ub85c \uc2dc\uc791\ud558\ub294 \ubd80\ubd84\uc744 \uad50\uccb4\ud574\uc918\uc57c \ud55c\ub2e4. \uadf8 \uc911 REPLACE_WITH_CF_DEPLOYMENT_NAME\uc740 \uc774\ud6c4\uc5d0 bosh command \uc2e4\ud589\uc2dc \uacc4\uc18d \uc0ac\uc6a9\ub420 \uba85\uce6d\uc774\ubbc0\ub85c \uc801\ub2f9\ud55c \uac12\uc744 \uc785\ub825\ud574\uc8fc\uba74 \ub418\uace0, cc\uc758 db_encryption_key \ud56d\ubaa9\uc740 32\uac1c\uc758 random \uac12\uc744 \uc785\ub825\ud574\uc8fc\uba74 \ub418\ubbc0\ub85c \uc544\ub798\uc758 command\ub97c \uc0ac\uc6a9\ud55c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"LC_ALL=C tr -dc 'A-Za-z0-9' < /dev/urandom | head -c 32 ; echo\n"})}),"\n",(0,r.jsx)(s.p,{children:"\uc0c1\uc138 \uc124\uc815 \ub0b4\uc6a9\uc5d0 \ub300\ud574\uc11c\ub294 \uc544\ub798\uc758 \ub450 \ubb38\uc11c\ub97c \ucc38\uc870 (\ub3d9\uc77c\ud558\uc9c0\ub294 \uc54a\uc73c\ub2c8 \uc9c0\uc815\ud560 \ud56d\ubaa9\uc5d0 \ub300\ud574\uc11c\ub9cc \ucc38\uc870\ud558\uba74 \ub418\uaca0\ub2e4)"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#fill-in-properties-stub",children:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#fill-in-properties-stub"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://docs.cloudfoundry.org/deploying/aws/cf-stub.html#editing",children:"http://docs.cloudfoundry.org/deploying/aws/cf-stub.html#editing"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) CF manifest \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc758 command\ub97c \uc2e4\ud589\ud55c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $CF_RELEASE_DIR\n./scripts/generate_deployment_manifest aws \\\n  $DEPLOYMENT_DIR/stubs/director-uuid.yml \\\n  $DIEGO_RELEASE_DIR/examples/aws/stubs/cf/diego.yml \\\n  $DEPLOYMENT_DIR/stubs/cf/properties.yml \\\n  $DEPLOYMENT_DIR/stubs/cf/stub.yml \\\n  > $DEPLOYMENT_DIR/deployments/cf.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) Upload stemcell"})}),"\n",(0,r.jsxs)(s.p,{children:["Component \ub4e4\uc774 \uc62c\ub77c\uac08 instance \ub4e4\uc758 base image\ub97c bosh director\ub85c \uc5c5\ub85c\ub4dc\ud558\ub294 \uacfc\uc815\uc73c\ub85c local\uc5d0 \uc788\ub294 stemcell\uc744 \uc62c\ub9b4\uc218\ub3c4 \uc788\uc9c0\ub9cc \ud604\uc7ac\ub294 \uac16\uace0 \uc788\uc9c0 \uc54a\uc73c\ubbc0\ub85c \uacf5\uac1c\ub418\uc5b4 \uc788\ub294 stemcell\uc744 \uc774\uc6a9\ud558\ub3c4\ub85d \ud55c\ub2e4. \uc774 \ub54c \ubc84\uc804\uc744 \uc9c0\uc815\ud560 \uc218\ub3c4 \uc788\ub294\ub370 \ub098\uc758 \uacbd\uc6b0\uc5d0\ub294 v267\uc744 \ubc30\ud3ec\ud560 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 ",(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/cf-release/releases/tag/v267",children:"release note"}),"\ub97c \ud655\uc778\ud574\uc11c 3421.11 \ubc84\uc804\uc73c\ub85c \uc9c4\ud589\ud568"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh upload-stemcell https://bosh.io/d/stemcells/bosh-aws-xen-hvm-ubuntu-trusty-go_agent?v=3421.11\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(4) Upload cf release"})}),"\n",(0,r.jsx)(s.p,{children:"\uc704\uc5d0\uc11c\ub3c4 \uc5b8\uae09\ud588\ub4ef\uc774 \ub300\ubd80\ubd84\uc758 \ubb38\uc11c\uc5d0\uc11c\ub294 create-release\ub97c \ud574\uc11c local\uc5d0 \uc0dd\uc131\ub41c release package\ub97c upload \ud558\ub77c\uace0 \uae30\uc220\ub418\uc5b4 \uc788\uc9c0\ub9cc \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\ub294 \uacbd\uc6b0\uac00 \uc788\uc5b4\uc11c \uc544\ub798\uc758 command\ub85c v267\uc744 upload \ud568"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh upload-release releases/cf/cf-267.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(5) Deploy"})}),"\n",(0,r.jsx)(s.p,{children:"Manifest\uac00 \uc0dd\uc131\ub418\uc5b4 \uc788\uace0 \ubc30\ud3ec\uc5d0 \ud544\uc694\ud55c package \ub4e4\ub3c4 upload\ub41c \uc0c1\ud0dc\uc774\uae30 \ub54c\ubb38\uc5d0 deploy \uba85\ub839\ub9cc bosh\ub85c \ub0b4\ub824\uc8fc\uba74 \ub41c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh -d codealley-cf deploy $DEPLOYMENT_DIR/deployments/cf.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:"\ubb38\uc81c\uc5c6\uc774 \uc644\ub8cc\ub41c \uacbd\uc6b0 \uc544\ub798 command\ub97c \uc2e4\ud589\ud574\ubcf4\uba74 \ubc30\ud3ec\ub41c component\uc5d0 \ub300\ud55c instance list\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh vms\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-02-cf-vms.png",children:(0,r.jsx)(s.img,{src:n(37270).A+"",width:"1024",height:"621"})})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"12-deploy-cf-mysql-for-diego",children:"12. Deploy CF MySQL for Diego"}),"\n",(0,r.jsx)(s.p,{children:"CF\ub97c \uad6c\uc131\ud558\ub294 \ub300\ubd80\ubd84\uc758 component\ub4e4\uc740 \ubc30\ud3ec\uac00 \ub41c \uc0c1\ud669\uc778\ub370 \uc911\uc694\ud55c diego\ub294 \uc5c6\ub2e4. \uacfc\uac70\uc5d0\ub294 \ub300\uc2e0 dea\uac00 \uc788\uc5c8\ub358 \uac83\uc73c\ub85c \ubcf4\uc774\ub294\ub370 \uc9c0\uae08\uc740 instance list\uc5d0\uc11c dea\ub97c \ud655\uc778\ud560 \uc218 \uc5c6\ub2e4. Diego \ubc30\ud3ec\ub97c \ud558\uae30 \uc804\uc5d0 diego\uac00 \uc0ac\uc6a9\ud560 db\ub97c \uc900\ube44\ud574\uc57c \ud55c\ub2e4\uace0 \ubb38\uc11c\uc5d0 \uae30\uc220\ub418\uc5b4 \uc788\ub294\ub370 aws rds\ub97c \uc774\uc6a9\ud558\uac70\ub098 standalone\uc73c\ub85c \uad6c\ucd95\ud558\ub294 \ubc29\ubc95, \ub610\ub294 cf-release\uc5d0 \ud3ec\ud568\ub418\uc5b4\uc788\ub294 postgresql\uc744 \uc774\uc6a9\ud560 \uc218 \uc788\ub294 \uac83 \uac19\ub2e4. \uadf8 \uc911\uc5d0\uc11c rds\ub294 \ube44\uc6a9\ubb38\uc81c\ub85c \ud3ec\uae30\ud558\uace0 \uc774\ubbf8 11\ubc88 \uacfc\uc815\uc5d0\uc11c \ubc30\ud3ec\ub41c postgresql\uc744 \uc774\uc6a9\ud574\ubcfc\uae4c \ud558\ub2e4\uac00 \uad81\uae08\ud574\uc11c standalone\uc73c\ub85c \uad6c\uc131\ud574\ubcf4\uae30\ub85c \ud588\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) Clone repository"})}),"\n",(0,r.jsx)(s.p,{children:"cf-mysql-deployment repo\ub97c clone\ud55c\ub2e4. (release-candidate branch)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $DEPLOYMENT_DIR\ngit clone -b release-candidate https://github.com/cloudfoundry/cf-mysql-deployment\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) Deployment name \uc124\uc815"})}),"\n",(0,r.jsx)(s.p,{children:"$DEPLOYMENT_DIR/stubs/cf-mysql/mysql-overrides-ops.yml \ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c REPLACE_WITH_CF_MYSQL_DEPLOYMENT_NAME \ubd80\ubd84\uc744 \uc6d0\ud558\ub294 \uba85\uce6d\uc73c\ub85c \uc9c0\uc815\ud55c\ub2e4."}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"(3) Consul"})," ips, ",(0,r.jsx)(s.strong,{children:"encrypt keys \uc9c0\uc815"})]}),"\n",(0,r.jsx)(s.p,{children:"\uc774\ubbf8 \ubc30\ud3ec\ub418\uc5b4 \uc788\ub294 consul\uc758 ip\ub4e4\uacfc encryption key\ub97c \uc124\uc815\ud574\uc57c \ud558\ub294\ub370 \ub458 \ub2e4 \ubcf5\uc218\ud615\uc774\ubbc0\ub85c yml \ud30c\uc77c\uc5d0 list\ub098 \ubc30\uc5f4\ud615\ud0dc\ub85c \uc9d1\uc5b4\ub123\uc5b4\uc918\uc57c \ud55c\ub2e4. (\ubb38\uc11c\uc5d0\ub294 encrypt_keys \ub77c\uace0\ub9cc \uba85\uc2dc\ub418\uc5b4 \uc788\uc5b4\uc11c \ucc98\uc74c\uc5d0\ub294 \ub2e8\uc77c \ubb38\uc790\uc5f4 \uac12\uc73c\ub85c \uc124\uc815\ud574\uc11c \ubc30\ud3ec\ud588\uc5c8\ub294\ub370 \uc624\ub958 \ubc1c\uc0dd)"}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc758 \ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c REPLACE_WITH_CONSUL_ENCRYPT_KEYS\uc640 REPLACE_WITH_CONSUL_SERVER_IPS\ub97c \uad50\uccb4\ud55c\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:"$DEPLOYMENT_DIR/stubs/cf-mysql/mysql-overrides-ops.yml"}),"\n",(0,r.jsx)(s.p,{children:"\uc774 \ub54c consul\uc758 ip\ub294 bosh vms \uba85\ub839\uc73c\ub85c \ud655\uc778"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh vms | grep consul\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(4) DB password \uc124\uc815"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc758 \ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c diego\uc640 locket schema\uc758 password\ub97c \uc6d0\ud558\ub294 \uac12\uc73c\ub85c \uc124\uc815\ud574\uc900\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:"$DEPLOYMENT_DIR/stubs/cf-mysql/mysql-overrides-ops.yml"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(5) Update cloud config / deploy"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798 command\ub97c \uc2e4\ud589\ud574\uc11c cloud config \ud30c\uc77c\uc744 \uac31\uc2e0\ud558\uace0 deploy"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh update-cloud-config $DEPLOYMENT_DIR/stubs/cloud-config.yml\nbosh -e ca-bosh -d codealley-cf-mysql deploy \\\n  $DEPLOYMENT_DIR/cf-mysql-deployment/cf-mysql-deployment.yml \\\n  --vars-file $DEPLOYMENT_DIR/stubs/cf-mysql/consul-secrets.yml \\\n  --vars-store $DEPLOYMENT_DIR/deployments/cf-mysql-vars.yml \\\n  -o $DEPLOYMENT_DIR/cf-mysql-deployment/operations/proxy-consul.yml \\\n  -o $DEPLOYMENT_DIR/stubs/cf-mysql/mysql-overrides-ops.yml --no-redact\n"})}),"\n",(0,r.jsx)(s.p,{children:"\uc5ed\uc2dc \ud2b9\ubcc4\ud55c \ubb38\uc81c\uc5c6\uc774 \uc644\ub8cc\ub418\uc5c8\ub2e4\uba74 \uc704\uc5d0\uc11c \uc9c0\uc815\ud55c deployment name\uc744 \uc9c0\uc815\ud574\uc11c vms \uba85\ub839\uc744 \uc2e4\ud589\ud574\ubcf4\uba74 \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc740 \ud615\ud0dc\uc758 instance list\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-03-cf-mysql-vms.png",children:(0,r.jsx)(s.img,{src:n(84393).A+"",width:"585",height:"473"})})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"13-deploy-diego",children:"13. Deploy Diego"}),"\n",(0,r.jsx)(s.p,{children:"\ub9c8\uc9c0\ub9c9\uc73c\ub85c diego\ub97c \ubc30\ud3ec\ud574\uc57c \ud558\ub294\ub370 \uc704\uc758 \uacfc\uc815\ub4e4\uacfc \uac70\uc758 \uc720\uc0ac\ud558\ub2e4. Stub \uc0dd\uc131 \ub610\ub294 \uc218\uc815, \uadf8\ub9ac\uace0 manifest \uc0dd\uc131 \ud6c4 \ud544\uc694\ud55c \uacbd\uc6b0 release package\ub97c \uc5c5\ub85c\ub4dc\ud558\uace0 deploy."}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"(1) Diego"})," sql ",(0,r.jsx)(s.strong,{children:"stub \uc0dd\uc131"})]}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798 \ubb38\uc11c\ub97c \ucc38\uc870\ud558\uba74 \uac01 \ud56d\ubaa9\uc744 \uc5b4\ub5a4 \uac12\uc73c\ub85c \ucc44\uc6cc\uc57c \ud558\ub294\uc9c0 \uc54c \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#fill-in-diego-sql-stub",children:"https://github.com/cloudfoundry/diego-release/tree/develop/examples/aws#fill-in-diego-sql-stub"})}),"\n",(0,r.jsx)(s.p,{children:"\ub300\ucda9 $DEPLOYMENT_DIR/stubs/diego/diego-sql.yml \ud30c\uc77c\uc774 \uc774\ub7f0 \ubaa8\uc591\uc774 \ub41c\ub2e4. (SSL \uc124\uc815\uc740 \uc548\ud568)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"sql_overrides:\n  bbs:\n    db_driver: mysql\n    db_host: mysql.service.cf.internal\n    db_port: 3306\n    db_username: diego\n    db_password: test1q2w3e\n    db_schema: diego\n    max_open_connections: 500\n    require_ssl: null\n    ca_cert: null\n  locket:\n    db_driver: mysql\n    db_host: mysql.service.cf.internal\n    db_port: 3306\n    db_username: locket\n    db_password: test1q2w3e\n    db_schema: locket\n    require_ssl: null\n    ca_cert: null\n"})}),"\n",(0,r.jsxs)(s.p,{children:["**(2) property-overrides.**yml ",(0,r.jsx)(s.strong,{children:"\ud30c\uc77c \uc218\uc815"})]}),"\n",(0,r.jsx)(s.p,{children:"$DEPLOYMENT_DIR/stubs/diego/property-overrides.yml \ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c REPLACE_WITH_ \ud56d\ubaa9\ub4e4\uc744 \uc9c0\uc815\ud574\uc57c \ud55c\ub2e4. REPLACE_WITH_ACTIVE_KEY_LABEL\uc740 \uc784\uc758\uc758 \uac12\uc73c\ub85c \uc815\ud574\ub3c4 \ubb34\ubc29\ud558\uace0 REPLACE_WITH_A_SECURE_PASSPHRASE \uc5ed\uc2dc \uc801\ud569\ud55c \uac12\uc73c\ub85c \uc124\uc815\ud55c\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) instance-count-overrides stub \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"Diego\uc758 component\ub4e4\uc744 \uc5b4\ub5a4 zone\uc5d0 \uba87\uac1c instance\ub85c \ubc30\ud3ec\ud560 \uac83\uc778\uc9c0\ub97c \uc124\uc815\ud558\ub294 \ub0b4\uc6a9\uc778\ub370 \ubb38\uc11c\uc0c1\uc5d0\ub294\xa0$DIEGO_RELEASE_DIR/examples/aws/stubs/diego/instance-count-overrides-example.yml \ud30c\uc77c\uc744 \ubcf5\uc0ac\ud574\uc11c \ubcc0\uacbd\ud574 \uc4f0\ub77c\uace0 \uba85\uc2dc\ub418\uc5b4 \uc788\uc9c0\ub9cc \uc2e4\uc81c \ud30c\uc77c\uc5d0\ub294 \uc0c1\uc138 \ub0b4\uc6a9\uc774 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \ud14c\uc2a4\ud2b8 \uc6a9\ub3c4\ub85c \ub9cc\ub4e4\uc5b4\uc9c4 \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud574\ubd24\ub2e4. \uc544\ub798 command\ub85c \ub2e4\uc6b4\ub85c\ub4dc\ud55c \ud30c\uc77c\uc744 \uc5f4\uc5b4\uc11c instance count\ub97c \uc9c0\uc815\ud558\uba74 \uc644\ub8cc. (Component \uc885\ub958\ubcc4\ub85c z1, z2\uc5d0 \ub300\ud574\uc11c\ub9cc \ud558\ub098\uc529 \uc9c0\uc815\ud568. \ud544\uc694\uc5c6\ub2e4\uace0 \uc0dd\uac01\ud55c \uc77c\ubd80 component\ub97c 0\uc73c\ub85c \uc9c0\uc815\ud558\uace0 \ubc30\ud3ec\ud574\ubcf4\ub2c8 \uc624\ub958)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"curl -o $DEPLOYMENT_DIR/stubs/diego/instance-count-overrides.yml \\\n  https://raw.githubusercontent.com/cloudfoundry/diego-upgrade-stability-tests/master/cell2/instance-count-overrides.yml \nvi $DEPLOYMENT_DIR/stubs/diego/instance-count-overrides.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(4) Release version stub \uc0dd\uc131"})}),"\n",(0,r.jsxs)(s.p,{children:["(3)\uacfc \ub3d9\uc77c\ud558\uac8c \ubb38\uc11c\uc0c1\uc5d0\ub294 \uc800\uc7a5\uc18c\uc5d0 \uc788\ub294 \ud30c\uc77c\uc744 \ubcf5\uc0ac\ud574\uc11c \uc4f0\ub77c\uace0 \ub418\uc5b4\uc788\uc73c\ub098 \ub0b4\uc6a9\uc740 \ube44\uc5b4\uc788\ub2e4. ",(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/cf-release/releases",children:"Release note"}),"\ub97c \ucc38\uace0\ud574\uc11c \ubc30\ud3ec\ud558\uace0\uc790 \ud558\ub294 cf version\uc5d0 \ud544\uc694\ud55c release package\ub4e4\uc744 \uc9c0\uc815\ud55c\ub2e4. ",(0,r.jsx)(s.a,{href:"https://github.com/cloudfoundry/cf-release/releases/tag/v267",children:"v267"}),"\uc758 \uacbd\uc6b0 \uc544\ub798\uc640 \uac19\uc740 \ub0b4\uc6a9\uc774\uba74 \ub418\uaca0\ub2e4."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cp $DIEGO_RELEASE_DIR/examples/aws/stubs/diego/release-versions.yml \\\n  $DEPLOYMENT_DIR/stubs/diego/release-versions.yml\nvi\xa0$DEPLOYMENT_DIR/stubs/diego/release-versions.yml\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"release-versions:\n  diego: 1.21.0\n  cflinuxfs2: 1.137.0\n  garden-runc: 1.9.0\n  cf-networking: 1.2.0\n  grootfs: 0.21.0\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(5) Diego manifest \uc0dd\uc131"})}),"\n",(0,r.jsx)(s.p,{children:"ETCD\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc744 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 -x \uc635\uc158\uc744 \ucd94\uac00\ud574\uc11c \uc0dd\uc131\ud588\uc74c"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cd $DIEGO_RELEASE_DIR\n./scripts/generate-deployment-manifest \\\n  -c $DEPLOYMENT_DIR/deployments/cf.yml \\\n  -i $DEPLOYMENT_DIR/stubs/diego/iaas-settings.yml \\\n  -p $DEPLOYMENT_DIR/stubs/diego/property-overrides.yml \\\n  -n $DEPLOYMENT_DIR/stubs/diego/instance-count-overrides.yml \\\n  -v $DEPLOYMENT_DIR/stubs/diego/release-versions.yml \\\n  -s $DEPLOYMENT_DIR/stubs/diego/diego-sql.yml \\\n  -x \\\n  > $DEPLOYMENT_DIR/deployments/diego.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(6) Upload release"})}),"\n",(0,r.jsx)(s.p,{children:"Diego\uc5d0 \ud544\uc694\ud55c release package\ub4e4\uc744 bosh\ub85c \uc62c\ub9ac\ub294 \uacfc\uc815\uc778\ub370 \uc5ed\uc2dc create-release \ud558\uc9c0 \uc54a\uace0 \uacf5\uac1c\ub418\uc5b4 \uc788\ub294 \ubc84\uc804\uc744 \uc774\uc6a9\ud588\ub2e4. \uc774 \ub54c \uc0ac\uc6a9\ud560 \ubc84\uc804\ub4e4\uc740 (4)\uc758 release-versions.yml \ud30c\uc77c\uacfc \ub3d9\uc77c\ud558\uac8c \ub9de\ucdb0\uc57c \ud55c\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh upload-release https://bosh.io/d/github.com/cloudfoundry/diego-release?v=1.21.0\nbosh -e ca-bosh upload-release https://bosh.io/d/github.com/cloudfoundry/cflinuxfs2-release?v=1.137.0\nbosh -e ca-bosh upload-release https://bosh.io/d/github.com/cloudfoundry/garden-runc-release?v=1.9.0\nbosh -e ca-bosh upload-release https://bosh.io/d/github.com/cloudfoundry-incubator/cf-networking-release?v=1.2.0\nbosh -e ca-bosh upload-release https://bosh.io/d/github.com/cloudfoundry/grootfs-release?v=0.21.0\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(7) Deploy"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc758 command\ub85c \uc704\uc5d0\uc11c \uc0dd\uc131\ud55c manifest\ub97c \uc9c0\uc815\ud574\uc11c \uc2e4\ud589"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"bosh -e ca-bosh -d codealley-cf-diego deploy $DEPLOYMENT_DIR/deployments/diego.yml\n"})}),"\n",(0,r.jsx)(s.p,{children:"\uc5ed\uc2dc deployment name\uc744 \uc9c0\uc815\ud574\uc11c instance list\ub97c \ud655\uc778\ud558\uba74 \uc544\ub798\uc758 \uadf8\ub9bc\ucc98\ub7fc \ud45c\uc2dc\ub41c\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-04-diego-vms.png",children:(0,r.jsx)(s.img,{src:n(97326).A+"",width:"1024",height:"622"})})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(8) \ubc30\ud3ec \ud655\uc778"})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc758 command\ub97c \uc2e4\ud589\ud574\uc11c \uc815\uc0c1\uc5ec\ubd80\ub97c \ud310\ub2e8\ud560 \uc218\ub3c4 \uc788\ub2e4. (info\ub97c \ud655\uc778\ud558\ub294 \uac83\uc740 diego\uc640\ub294 \uad00\uacc4\uac00 \uc5c6\uae30 \ub54c\ubb38\uc5d0 cf \ubc30\ud3ec\ud6c4\uc5d0\ub3c4 \ud655\uc778\ud560 \uc218 \uc788\ub294 \ub0b4\uc6a9)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"curl api.codealley-cf.com/info\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-06-check-deploy.png",children:(0,r.jsx)(s.img,{src:n(55573).A+"",width:"570",height:"439"})})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"14-install-cf-cli",children:"14. Install CF cli"}),"\n",(0,r.jsxs)(s.p,{children:["\uc774\uc81c \ubc30\ud3ec\ub41c cf\uc5d0 application\uc744 \uc62c\ub824\ubcfc \ucc28\ub840\uc778\ub370 \uadf8 \uc804\uc5d0 cf cli\ub97c \uc124\uce58\ud574\uc57c \ud55c\ub2e4. ",(0,r.jsx)(s.a,{href:"https://docs.cloudfoundry.org/cf-cli/install-go-cli.html",children:"\ub9c1\ud06c \ubb38\uc11c"}),"\ub97c \ucc38\uc870\ud558\uac70\ub098 \uc544\ub798\uc758 command\ub85c \uc124\uce58"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:'wget -q -O - https://packages.cloudfoundry.org/debian/cli.cloudfoundry.org.key | sudo apt-key add -\necho "deb http://packages.cloudfoundry.org/debian stable main" | sudo tee /etc/apt/sources.list.d/cloudfoundry-cli.list\nsudo apt-get update\nsudo apt-get install cf-cli\n'})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"15-deploy-sample-application",children:"15. Deploy sample application"}),"\n",(0,r.jsx)(s.p,{children:"CF cli\ub97c \ucc98\uc74c \uc2e4\ud589\ud558\ub294 \uac70\ub77c\uba74 org, space \uc0dd\uc131\uacfc target space \uc9c0\uc815 \ub4f1\uc758 \uacfc\uc815\uc774 \ud544\uc694\ud558\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(1) CF login"})}),"\n",(0,r.jsx)(s.p,{children:"\uc0ac\uc6a9\ud558\uae30\ub85c \uc124\uc815\ud55c cf\uc758 api domain\uc5d0 \uc5f0\uacb0\uc744 \ud574\uc57c\ud558\ub294\ub370 self signed \uc778\uc99d\uc11c\ub97c \ub123\uc5b4\ub450\uc5c8\uc73c\ubbc0\ub85c --skip-ssl-validation \uc635\uc158\uc744 \uc8fc\uc5b4\uc57c \ud55c\ub2e4. \uc774 \ub54c \uc0ac\uc6a9\ub418\ub294 \uacc4\uc815(Email)\uc740 admin\uc73c\ub85c password\ub294 \uc774\uc804\uc5d0 \uc124\uc815\ud588\ub358 \uac12\uc73c\ub85c \uc785\ub825 (\ub098\uc758 \uacbd\uc6b0\uc5d4 test1q2w3e)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cf login -a https://api.codealley-cf.com --skip-ssl-validation\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-07-cf-login.png",children:(0,r.jsx)(s.img,{src:n(96213).A+"",width:"563",height:"322"})})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(2) Org, space \uc0dd\uc131\uacfc target \uc9c0\uc815"})}),"\n",(0,r.jsx)(s.p,{children:"Org\ub294 \uae30\ubcf8\uc73c\ub85c system\uc774 \uc0dd\uc131\ub418\uc5b4 \uc788\ub294\ub370 \ubcc4\ub3c4\ub85c \ub9cc\ub4e4\uc5b4\ub3c4 \uc88b\uace0 \uadf8\ub0e5 \uc4f0\uaca0\ub2e4\uba74 \uc544\ub798 command\ub85c space(\uc774 \uacbd\uc6b0\uc5d4 development)\ub9cc \ud558\ub098 \uc0dd\uc131\ud558\uace0 \ud574\ub2f9 space\ub97c target\uc73c\ub85c \uc9c0\uc815\ud558\uba74 \ub418\uaca0\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"cf create-space development\ncf target -s development\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"(3) Clone sample application & deploy"})}),"\n",(0,r.jsx)(s.p,{children:"CF sample \uc911 spring-music\uc744 \ubc30\ud3ec\ud574\ubcf4\uae30\ub85c \ud588\ub294\ub370 \ub9ce\uc740 \uacbd\uc6b0 cf push \uba85\ub839\ub9cc\uc73c\ub85c \ubc30\ud3ec\uac00 \uac00\ub2a5\ud558\uc9c0\ub9cc spring-music\uc758 \uacbd\uc6b0 \ube4c\ub4dc \uacfc\uc815\uc774 \ud544\uc694\ud55c \uac83 \uac19\ub2e4. Java8\uc774 \uc124\uce58\ub418\uc5b4\uc788\uc9c0 \uc54a\uc558\uc73c\ubbc0\ub85c \uc124\uce58\ud558\uace0 JAVA_HOME \uc9c0\uc815"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"# Install java8 and export JAVA_HOME\nsudo add-apt-repository ppa:webupd8team/java -y\nsudo apt-get update\nsudo apt-get install -y oracle-java8-installer\necho 'export JAVA_HOME=/usr/lib/jvm/java-8-oracle' >> ~/.profile\nsource ~/.profile\n\n# Clone and build\ngit clone https://github.com/cloudfoundry-samples/spring-music\ncd spring-music\n./gradlew clean assemble\n\n# Deploy\ncf push\n"})}),"\n",(0,r.jsx)(s.p,{children:"Push\uac00 \uc644\ub8cc\ub418\uba74 \uc544\ub798\uc640 \uac19\uc740 \ud654\uba74\uc744 \ubcfc \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-08-cf-push.png",children:(0,r.jsx)(s.img,{src:n(3795).A+"",width:"570",height:"439"})})}),"\n",(0,r.jsx)(s.p,{children:"CF cli \uba85\ub839 \uc911 \ubc30\ud3ec\ub41c application \uc804\uccb4\ub97c \ud655\uc778\ud558\ub294 cf apps\ub97c \uc2e4\ud589\ud574\ubcf4\uba74 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc \uc0c1\ud0dc\uc640 \uc0ac\uc6a9\uc911\uc778 resource \uc815\ubcf4\uac00 \ud45c\uc2dc\ub418\uace0 \uc790\ub3d9\uc73c\ub85c \ud560\ub2f9\ub41c url\ub3c4 \ud655\uc778 \uac00\ub2a5\ud558\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-09-cf-apps.png",children:(0,r.jsx)(s.img,{src:n(81330).A+"",width:"570",height:"439"})})}),"\n",(0,r.jsx)(s.p,{children:"cf apps\uc5d0 \ud45c\uc2dc\ub41c url\ub85c \uc811\uc18d\ud558\uba74 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc \ubc30\ud3ec\ub41c \uc0c1\ud0dc\uc758 application \ud654\uba74\uc744 \ubcfc \uc218 \uc788\uc74c"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-10-access-app.png",children:(0,r.jsx)(s.img,{src:n(22137).A+"",width:"1024",height:"621"})})}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.p,{children:"\xa0"}),"\n",(0,r.jsx)(s.h3,{id:"16-resources",children:"16. Resources"}),"\n",(0,r.jsx)(s.p,{children:"CF\ub97c \ubc30\ud3ec\ud558\uace0 \ub098\uc11c aws\uc5d0 \uc0dd\uc131\ub41c resource\uac00 \uc5bc\ub9c8\ub098 \ub418\ub294\uc9c0 \ud655\uc778\ud574 \ubcf4\ub2c8 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc instance\uac00 \uc0c1\ub2f9\ud788 \ub9ce\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"http://13.125.231.217/wp-content/uploads/2017/08/cf-11-resources.png",children:(0,r.jsx)(s.img,{src:n(33850).A+"",width:"654",height:"209"})})}),"\n",(0,r.jsx)(s.p,{children:"41\uac1c vm \uc911 bosh director\uc640 NAT\uc6a9 vm\uc774 \ud558\ub098\uc529\uc774\uace0 cf\ub97c \uad6c\uc131\ud558\ub294 component vm\uc774 \ubb34\ub824 38\uac1c (HA \uad6c\uc131. Diego\uc6a9 db\ub294 \uc904\uc77c \uc218 \uc788\uc744 \uac83 \uac19\uae30\ub3c4 \ud568), application\uc774 \uc62c\ub77c\uac08 \uc218 \uc788\ub294 diego cell\uc740 1\uac1c \ubfd0\uc774\ub2e4. Application\uc744 \ub9ce\uc774 \ubc30\ud3ec\ud560\uc218\ub85d cell\uc744 \ucd94\uac00\ud574\uc57c \ud558\uace0 \uae30\ud0c0 LB\ub098S3, attach\ub41c disk \uc0ac\uc6a9\ub8cc, traffic \ube44\uc6a9\uae4c\uc9c0 \uace0\ub824\ud558\uba74 \uaf64 \ud070 \uaddc\ubaa8\uc758 resource \uc0ac\uc6a9\uc744 \uc608\uc0c1\ud558\uace0 \uc900\ube44\ud574\uc57c \ud560 \uac83 \uac19\ub2e4."})]})}function p(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},15382:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-01-set_api-error-b04284f4ae0da9c0d9d44f019ffd6354.png"},37270:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-02-cf-vms-1024x621-1c117ea22fdc6a3ccbef2d8059331268.png"},84393:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-03-cf-mysql-vms-a67d5ab79f54e59c90e8effefeb080a1.png"},97326:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-04-diego-vms-1024x622-ea43d5a5b273c46440dfb9fedb9094ba.png"},55573:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-06-check-deploy-c7de4e648b1e0e2485cf037672eb5980.png"},96213:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-07-cf-login-bbd40bfe64772868cc494c4f68d968d4.png"},3795:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-08-cf-push-2a53d9ca280c26bf8a1e8ebff1ab72b7.png"},81330:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-09-cf-apps-4f0ef378c08af4e843be9ddae305e264.png"},22137:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-10-access-app-1024x621-4fe351054c620fb746f8b7842c4e32ce.png"},33850:(e,s,n)=>{n.d(s,{A:()=>r});const r=n.p+"assets/images/cf-11-resources-6cf87581029c4ab18dc741f1a219c9c4.png"},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>i});var r=n(96540);const c={},o=r.createContext(c);function l(e){const s=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),r.createElement(o.Provider,{value:s},e.children)}}}]);