<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Juju bootstrap &amp; deploy | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blurblah.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blurblah.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blurblah.github.io/2015/08/31/wp/juju-bootstrap-deploy"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Juju bootstrap &amp; deploy | My Site"><meta data-rh="true" name="description" content="Ubuntu를 배포하고 있는 Canonical에서 사용자가 cloud 환경에서 쉽게 서비스를 모델링하고 배포하기 위한 tool을 Juju라는 이름으로 내놓았다. Server instance를 간편하게 관리한다는 측면에서는 Chef와 유사하지만 instance 자체를 생성하거나 제거할 수 있기 때문에 또 다른 것 같다. Juju는 instance가 아닌 service 위주의 관리와 배포를 목적으로 하고 있는 것으로 보인다. 실제로 특정 서비스 (charm이라고 부르는)를 deploy하면 신규 instance를 추가해서 charm에 정의된 내용대로 서비스를 배포하게 된다. (option에 따라 이미 추가된 instance에 배포하는 것도 가능)"><meta data-rh="true" property="og:description" content="Ubuntu를 배포하고 있는 Canonical에서 사용자가 cloud 환경에서 쉽게 서비스를 모델링하고 배포하기 위한 tool을 Juju라는 이름으로 내놓았다. Server instance를 간편하게 관리한다는 측면에서는 Chef와 유사하지만 instance 자체를 생성하거나 제거할 수 있기 때문에 또 다른 것 같다. Juju는 instance가 아닌 service 위주의 관리와 배포를 목적으로 하고 있는 것으로 보인다. 실제로 특정 서비스 (charm이라고 부르는)를 deploy하면 신규 instance를 추가해서 charm에 정의된 내용대로 서비스를 배포하게 된다. (option에 따라 이미 추가된 instance에 배포하는 것도 가능)"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2015-08-31T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="bootstrap,canonical,charm,db-relation-changed,db-relation-joined,deploy,juju,relation"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blurblah.github.io/2015/08/31/wp/juju-bootstrap-deploy"><link data-rh="true" rel="alternate" href="https://blurblah.github.io/2015/08/31/wp/juju-bootstrap-deploy" hreflang="en"><link data-rh="true" rel="alternate" href="https://blurblah.github.io/2015/08/31/wp/juju-bootstrap-deploy" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.87564fa0.css">
<script src="/assets/js/runtime~main.e36f3c5d.js" defer="defer"></script>
<script src="/assets/js/main.dfb2dcc2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/blurblah" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2020/01/20/wp/kubernetes에서-특정-node에-pod가-배포되는-현상에-대한-분석">Kubernetes에서 특정 node에 pod가 배포되는 현상에 대한 분석</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/08/14/wp/kubernetes-with-aws-api-gateway">Kubernetes with AWS API gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/06/09/wp/날씨-정보를-편하게-받아볼까-해서-시작한-일들">날씨 정보를 편하게 받아볼까 해서 시작한 일들</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/05/27/wp/xiaomi-센서로-실내-온도를-측정해서-influxdb에-저장하고-grafana로-그">Xiaomi 센서로 실내 온도를 측정해서 InfluxDB에 저장하고 Grafana로 그린다</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/05/17/wp/snmp를-통한-asus-공유기-모니터링-시작하기">SNMP를 통한 ASUS 공유기  모니터링 시작하기</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Ubuntu를 배포하고 있는 Canonical에서 사용자가 cloud 환경에서 쉽게 서비스를 모델링하고 배포하기 위한 tool을 Juju라는 이름으로 내놓았다. Server instance를 간편하게 관리한다는 측면에서는 Chef와 유사하지만 instance 자체를 생성하거나 제거할 수 있기 때문에 또 다른 것 같다. Juju는 instance가 아닌 service 위주의 관리와 배포를 목적으로 하고 있는 것으로 보인다. 실제로 특정 서비스 (charm이라고 부르는)를 deploy하면 신규 instance를 추가해서 charm에 정의된 내용대로 서비스를 배포하게 된다. (option에 따라 이미 추가된 instance에 배포하는 것도 가능)"><header><h1 class="title_f1Hy" itemprop="headline">Juju bootstrap &amp; deploy</h1><div class="container_mt6G margin-vert--md"><time datetime="2015-08-31T00:00:00.000Z" itemprop="datePublished">August 31, 2015</time> · <!-- -->10 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Ubuntu를 배포하고 있는 Canonical에서 사용자가 cloud 환경에서 쉽게 서비스를 모델링하고 배포하기 위한 tool을 Juju라는 이름으로 내놓았다. Server instance를 간편하게 관리한다는 측면에서는 Chef와 유사하지만 instance 자체를 생성하거나 제거할 수 있기 때문에 또 다른 것 같다. Juju는 instance가 아닌 service 위주의 관리와 배포를 목적으로 하고 있는 것으로 보인다. 실제로 특정 서비스 (charm이라고 부르는)를 deploy하면 신규 instance를 추가해서 charm에 정의된 내용대로 서비스를 배포하게 된다. (option에 따라 이미 추가된 instance에 배포하는 것도 가능)</p>
<p>참고 : 아래의 모든 터미널 이미지에 표시된 dns name과 instance-id 들은 이미 다 destroy 해서 사용할 수 없는 정보들임</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-juju의-구조">1. Juju의 구조<a href="#1-juju의-구조" class="hash-link" aria-label="Direct link to 1. Juju의 구조" title="Direct link to 1. Juju의 구조">​</a></h4>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_architecture.jpg" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_architecture" src="/assets/images/juju_architecture-6ac08b71c7859e5eda378f901819b870.jpg" width="638" height="479" class="img_ev3q"></a>
&lt;출처 : <a href="http://www.slideshare.net/LeonardoBorda/leonardo-borda-maas-and-juju-introduction%5C%3E" target="_blank" rel="noopener noreferrer">http://www.slideshare.net/LeonardoBorda/leonardo-borda-maas-and-juju-introduction\&gt;</a></p>
<p>Juju는 위 그림처럼 client가 state server에 상태값을 추가하거나 update 하도록 되어있고 하위의 모든 machine 들은 state의 변경에 따라 특정 동작을 처리하도록 되어있는 것으로 보인다. 예를 들어 wordpress와 mysql을 연결하라는 명령을 client에서 보내면 내부적으로 event가 발생되고 wordpress, mysql이 event에 맞는 hook을 실행해 세부적인 동작을 처리하게 되며 그 과정에서의 상태값들은 모두 state server에 저장되거나 변경된다. (State는 Mongo DB로 관리되는 것으로 보임)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-bootstrap">2. Bootstrap<a href="#2-bootstrap" class="hash-link" aria-label="Direct link to 2. Bootstrap" title="Direct link to 2. Bootstrap">​</a></h4>
<p>Juju client 설치 후 내가 사용하는 cloud 환경 (AWS, MS Azure, Openstack, Joyent, GCE, VMWare 등 대부분의 환경을 지원한다)에 대한 설정을 마친 후에 bootstrap 명령을 내리면 bootstrap instance를 생성하고 필요한 tool들의 설치, 설정까지 진행한다. Bootstrap instance는 state server로서 동작하게 된다.</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_bootstrap.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_bootstrap" src="/assets/images/juju_bootstrap-d64083add35d671c5f23171450b025f1.png" width="682" height="534" class="img_ev3q"></a></p>
<p>Azure의 경우 vnet 생성 후에 instance를 생성해서 연결하게 되고 hash가 포함된 것으로 보이는 문자열로 DNS name을 설정하는 걸 확인할 수 있다. 사실 Juju로 관리할 경우 DNS name은 크게 중요한 요소는 아닌데 아래의 그림처럼 state server에서 별도로 일련번호(0)나 unit name을 붙이고 있어서 client에서는 DNS name이 아니라 일련번호나 unit name으로 대부분의 관리가 가능하다.</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_status_after_bootstrap.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_status_after_bootstrap" src="/assets/images/juju_status_after_bootstrap-f01c189d32b3d239d281179b238a5217.png" width="682" height="534" class="img_ev3q"></a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-charm">3. Charm<a href="#3-charm" class="hash-link" aria-label="Direct link to 3. Charm" title="Direct link to 3. Charm">​</a></h4>
<p>Juju에서 배포하고자 하는 service들은 charm이라는 이름으로 정의되고 관리된다. (Chef에서 cookbook이나 recipe처럼) Charm의 구성요소는 아래와 같다.</p>
<p>(1) Metadata</p>
<p>(2) Hooks</p>
<p>(3) Custom contents</p>
<p>Metadata는 name, description, relation, configuration option 등으로 구성이 되는데 이 중 중요한 것은 relation이다.</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_wordpress_metadata.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_wordpress_metadata" src="/assets/images/juju_wordpress_metadata-dbd4b2c375cf5ce5f5c500d828910d79.png" width="708" height="315" class="img_ev3q"></a>예를 들어, Wordpress charm의 metadata는 위의 그림처럼 정의되어 있는데 requires와 provides, peers로 된 부분이 relation 설정이다. Relation은 interface, kind, name으로 구성되어 있는데 각각의 정의는 이렇다.</p>
<p>Interface : Hook을 통해서 정보를 교환하기 위한 protocol (진짜 interface의 의미도 있지만...)</p>
<p>Kind : Relation의 종류로 requirer, provder, peer 중 하나를 의미하는데 requirer는 이런 relation이 필요해, provider는 이런 relation을 내가 해줄게, peer는 클러스터링 할 때는 이런 걸로 하자로 이해하면 편할 것 같다.</p>
<p>Name : identifier로서의 역할이고 위 wordpress metadata에서 보면 name 항목의 wordpress,  requires: db: interface: mysql 항목의 mysql을 모두 name이라고 생각하면 된다.</p>
<p>Hook은 위에서도 언급했듯이 event가 발생했을 때 실행되는 script로 어떤 언어로 된 script도 관계없다고 명시되어 있다. 그러니까 특정 event 발생시 각 service unit들이 해줘야 하는 동작을 script로 정의하면 되는데 몇 개 charm을 둘러보니 대부분 bash와 python으로 구현하는 것으로 보인다.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-deploy">4. Deploy<a href="#4-deploy" class="hash-link" aria-label="Direct link to 4. Deploy" title="Direct link to 4. Deploy">​</a></h4>
<p>Bootstrap 한 이후에 위의 charm을 가지고 deploy하는 과정은 단순히 juju deploy &lt;charm name&gt; 형태의 command만 실행하면 된다. 정말 간단하다. 실행하면 charm이 올라갈 instance를 생성하고 instance 생성이 완료되면 charm에 정의된 install hook이 실행되서 필요한 tool을 설치하거나 설정하게 된다. 그리고 deploy 후에 state server (bootstrap instance)에 상태 정보를 요청하면 아래와 같은 내용을 확인할 수 있다.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="juju_status_after_deploy5-instance에-접속하고-싶다면"><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_status_after_deploy.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_status_after_deploy" src="/assets/images/juju_status_after_deploy-4ef179ac0a0b9cf83881de80dc6b1eac.png" width="682" height="982" class="img_ev3q"></a>5. Instance에 접속하고 싶다면<a href="#juju_status_after_deploy5-instance에-접속하고-싶다면" class="hash-link" aria-label="Direct link to juju_status_after_deploy5-instance에-접속하고-싶다면" title="Direct link to juju_status_after_deploy5-instance에-접속하고-싶다면">​</a></h4>
<p>대부분의 관리가 juju command로 가능하지만 그래도 배포된 instance에 접속해야하는 상황이 있을 수 있다. 그 경우 juju ssh 0 (0번은 bootstrap instance에 대해서 붙여진 번호), juju ssh &lt;unit_name&gt; 형태의 command를 사용하면 ssh로 접속이 가능하다. 실제로 bootstrap instance나 다른 instance를 생성할 때 juju client에서 관리하는 public key를 전송해서 각 instance (machine)의 authorized_keys에 추가하기 때문에 juju command가 싫다면</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i &lt;private_key_path&gt; ubuntu@&lt;dns_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>으로 접속할 수 있다. (Juju client가 설치된 장비의 private key는 기본적으로 ~/.juju/ssh 경로에 생성됨)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="juju_ssh_using_private_key6-add-relation"><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_ssh_using_private_key.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_ssh_using_private_key" src="/assets/images/juju_ssh_using_private_key-93e0322912011d64873060a859f601ff.png" width="682" height="534" class="img_ev3q"></a>6. Add relation<a href="#juju_ssh_using_private_key6-add-relation" class="hash-link" aria-label="Direct link to juju_ssh_using_private_key6-add-relation" title="Direct link to juju_ssh_using_private_key6-add-relation">​</a></h4>
<p>4에서처럼 charm을 deploy 하고나면 단지 설치만 된다. Wordpress charm의 경우 설치했을 때 wordpress만 설치되고 mysql 등의 DB는 별도로 설치되지 않는다. MySQL이 필요하니 deploy를 한다해도 역시 설치만 되고 각 service는 별개의 것으로 남아있게 된다. juju add-relation wordpress mysql 명령을 실행해보자. (wordpress, mysql은 charm의 이름이지만 이미 설치된 것이고 state server에서 각 service unit에 대한 상태를 관리하고 있으니 문제없다)</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_db_relation_joined.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_db_relation_joined" src="/assets/images/juju_db_relation_joined-e0269acda9b667187b6942467dadc91d.png" width="654" height="450" class="img_ev3q"></a><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_db_relation_changed.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_db_relation_changed" src="/assets/images/juju_db_relation_changed-12b34caf88619fe3c41988e02cc92c86.png" width="654" height="450" class="img_ev3q"></a>위 그림은 순서대로 mysql과 wordpress가 설치된 instance에서 수집한 로그인데 add-relation 명령 실행시 mysql에서는 db-relation-joined, wordpress에서는 db-relation-changed가 순차적으로 실행되는 것을 확인할 수 있다. db-relation-joined와 db-relation-changed는 각각 mysql과 wordpress charm에 정의되어 있는 hook으로 add-relation 명령이 수행되면 wordpress와 mysql이 provide하고 require하고 있는 항목인 db에 대한 relation-joined hook이 실행되는데 db-relation-joined hook은 mysql에만 정의되어 있으므로 먼저 실행된다.</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_relation_set.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_relation_set" src="/assets/images/juju_relation_set-a07550cadbb64b5ce573eb8f1eb05573.png" width="332" height="136" class="img_ev3q"></a>db-relation-joined hook의 내용을 살펴보면 위 그림처럼 relation-set 명령을 호출해서 db 접속정보를 설정하는 것을 알 수 있다. 위의 접속정보는 state server에 저장되고나면 변경사항이 발생되었기 때문에 db-relation-changed hook이 실행되는데 이것은 wordpress에만 정의되어 있는 hook이므로 wordpress에서만 실행되며 state server에 저장된 db 접속정보를 받아와서 설치된 wordpress에 설정파일들을 수정하거나 다른 조작을 가하도록 정의되어 있어 wordpress와 mysql 사이의 연결이 가능해진다.</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_relation_get.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_relation_get" src="/assets/images/juju_relation_get-620046d7aa6bd71392bb968e2f50be87.png" width="285" height="79" class="img_ev3q"></a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-expose">7. Expose<a href="#7-expose" class="hash-link" aria-label="Direct link to 7. Expose" title="Direct link to 7. Expose">​</a></h4>
<p>Deploy와 relation의 과정을 거치고 나더라도 바로 wordpress를 이용할 수는 없다. Cloud service 들의 특성상 보안 등의 이유로 대부분의 port는 연결이 되지 않도록 막혀있기 때문에 특정 port를 열어주는 작업이 필요하다. 위의 과정으로 deploy 한 것은 wordpress와 mysql 뿐이고 wordpress만 열면 되기 때문에 간단하게</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">juju expose wordpress</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>명령만 실행하고 나면 약간의 시간 후에 아래의 그림처럼 endpoint 설정이 추가된 것을 확인할 수 있다. (Azure 기준)</p>
<p><a href="https://blurblah.net/wp-content/uploads/2015/08/juju_expose.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju_expose" src="/assets/images/juju_expose-c8cbe72d5d171dcfd7592aecc645606f.png" width="931" height="215" class="img_ev3q"></a>Wordpress나 MySQL charm에서 어떤 부분이 expose를 가능하게 하는지 아직 찾지 못했다. MySQL을 expose 해보니 status에서 exposed flag 값만 false에서 true로 바뀔 뿐 실제 endpoint 설정이 추가되지는 않는데 이 부분은 좀 더 살펴볼 필요가 있을 것 같다.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="8-참고">8. 참고<a href="#8-참고" class="hash-link" aria-label="Direct link to 8. 참고" title="Direct link to 8. 참고">​</a></h4>
<p><a href="https://jujucharms.com/docs/stable/getting-started" target="_blank" rel="noopener noreferrer">https://jujucharms.com/docs/stable/getting-started</a></p>
<p><a href="http://blog.labix.org/2013/06/25/the-heart-of-juju" target="_blank" rel="noopener noreferrer">http://blog.labix.org/2013/06/25/the-heart-of-juju</a></p>
<p><a href="http://askubuntu.com/questions/55179/what-is-the-purpose-of-the-bootstrapping-instance-in-juju" target="_blank" rel="noopener noreferrer">http://askubuntu.com/questions/55179/what-is-the-purpose-of-the-bootstrapping-instance-in-juju</a></p>
<p><a href="http://www.slideshare.net/LeonardoBorda/leonardo-borda-maas-and-juju-introduction" target="_blank" rel="noopener noreferrer">http://www.slideshare.net/LeonardoBorda/leonardo-borda-maas-and-juju-introduction</a></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/bootstrap">bootstrap</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/canonical">canonical</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/charm">charm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/db-relation-changed">db-relation-changed</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/db-relation-joined">db-relation-joined</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/deploy">deploy</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/juju">juju</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/relation">relation</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2015/10/07/wp/jenkins-plugin-개발환경-설정"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Jenkins plugin 개발환경 설정</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2014/07/15/wp/gerrit에서-custom-label-생성하기"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Gerrit에서 custom label 생성하기</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>