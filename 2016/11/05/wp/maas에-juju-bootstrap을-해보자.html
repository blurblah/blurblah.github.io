<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">MAAS에 juju bootstrap을 해보자 | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blurblah.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blurblah.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blurblah.github.io/2016/11/05/wp/maas에-juju-bootstrap을-해보자"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="MAAS에 juju bootstrap을 해보자 | My Site"><meta data-rh="true" name="description" content="MAAS 구축하기를 통해 만들어진 node 들을 사용자들이 acquire 해서 각자의 용도에 맞게 사용할 수도 있지만 juju를 이용하면 자동 배포 및 관리도 가능하다. MAAS를 사용하게 된 이유 중 하나가 ceph을 더 살펴보기 위해서인데 (Juju로 Ceph을 deploy 해보자 참조) 어찌보면 배보다 배꼽이 더 큰 경우일 수도 있겠지만 어디까지나 재미로 혹은 공부한다 생각하니 효율적이지 못해도 괜찮다고 본다."><meta data-rh="true" property="og:description" content="MAAS 구축하기를 통해 만들어진 node 들을 사용자들이 acquire 해서 각자의 용도에 맞게 사용할 수도 있지만 juju를 이용하면 자동 배포 및 관리도 가능하다. MAAS를 사용하게 된 이유 중 하나가 ceph을 더 살펴보기 위해서인데 (Juju로 Ceph을 deploy 해보자 참조) 어찌보면 배보다 배꼽이 더 큰 경우일 수도 있겠지만 어디까지나 재미로 혹은 공부한다 생각하니 효율적이지 못해도 괜찮다고 본다."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2016-11-05T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="boostrap,juju,maas,maas-juju-연결,no-auto-upgrade,waiting-for-api-to-become-available"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blurblah.github.io/2016/11/05/wp/maas에-juju-bootstrap을-해보자"><link data-rh="true" rel="alternate" href="https://blurblah.github.io/2016/11/05/wp/maas에-juju-bootstrap을-해보자" hreflang="en"><link data-rh="true" rel="alternate" href="https://blurblah.github.io/2016/11/05/wp/maas에-juju-bootstrap을-해보자" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.87564fa0.css">
<script src="/assets/js/runtime~main.e36f3c5d.js" defer="defer"></script>
<script src="/assets/js/main.dfb2dcc2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/blurblah" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2020/01/20/wp/kubernetes에서-특정-node에-pod가-배포되는-현상에-대한-분석">Kubernetes에서 특정 node에 pod가 배포되는 현상에 대한 분석</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/08/14/wp/kubernetes-with-aws-api-gateway">Kubernetes with AWS API gateway</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/06/09/wp/날씨-정보를-편하게-받아볼까-해서-시작한-일들">날씨 정보를 편하게 받아볼까 해서 시작한 일들</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/05/27/wp/xiaomi-센서로-실내-온도를-측정해서-influxdb에-저장하고-grafana로-그">Xiaomi 센서로 실내 온도를 측정해서 InfluxDB에 저장하고 Grafana로 그린다</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2018/05/17/wp/snmp를-통한-asus-공유기-모니터링-시작하기">SNMP를 통한 ASUS 공유기  모니터링 시작하기</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="MAAS 구축하기를 통해 만들어진 node 들을 사용자들이 acquire 해서 각자의 용도에 맞게 사용할 수도 있지만 juju를 이용하면 자동 배포 및 관리도 가능하다. MAAS를 사용하게 된 이유 중 하나가 ceph을 더 살펴보기 위해서인데 (Juju로 Ceph을 deploy 해보자 참조) 어찌보면 배보다 배꼽이 더 큰 경우일 수도 있겠지만 어디까지나 재미로 혹은 공부한다 생각하니 효율적이지 못해도 괜찮다고 본다."><header><h1 class="title_f1Hy" itemprop="headline">MAAS에 juju bootstrap을 해보자</h1><div class="container_mt6G margin-vert--md"><time datetime="2016-11-05T00:00:00.000Z" itemprop="datePublished">November 5, 2016</time> · <!-- -->6 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><a href="http://13.125.231.217/1405" target="_blank" rel="noopener noreferrer">MAAS 구축하기</a>를 통해 만들어진 node 들을 사용자들이 acquire 해서 각자의 용도에 맞게 사용할 수도 있지만 juju를 이용하면 자동 배포 및 관리도 가능하다. MAAS를 사용하게 된 이유 중 하나가 ceph을 더 살펴보기 위해서인데 (<a href="http://13.125.231.217/1329" target="_blank" rel="noopener noreferrer">Juju로 Ceph을 deploy 해보자</a> 참조) 어찌보면 배보다 배꼽이 더 큰 경우일 수도 있겠지만 어디까지나 재미로 혹은 공부한다 생각하니 효율적이지 못해도 괜찮다고 본다.</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-prerequisites">1. Prerequisites<a href="#1-prerequisites" class="hash-link" aria-label="Direct link to 1. Prerequisites" title="Direct link to 1. Prerequisites">​</a></h3>
<p>Juju를 먼저 설치해야 한다. (<a href="https://jujucharms.com/docs/stable/getting-started" target="_blank" rel="noopener noreferrer">getting-started 문서</a> 참조) 나의 경우엔 예전에 설치해 둔 상태라 1.25.3 버전이 설치되어 있는데 현재 최신 버전은 2.0이고 각 버전별로 기능 차이가 있으니(버그도...) 주의가 필요하다. MAAS에 접속해서 사전에 MAAS key를 복사해 두어야 한다.</p>
<p><a href="http://13.125.231.217/wp-content/uploads/2016/11/maas-keys.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="maas-keys" src="/assets/images/maas-keys-192b471029b0797e6537bb43b33d920b.png" width="1552" height="985" class="img_ev3q"></a></p>
<p>MAAS에 로그인 후 계정 이름을 클릭해서 Account 메뉴를 선택하면 위 그림과 같은 화면이 표시되는데 기본으로 생성되어 있는 MAAS key를 복사해둔다. 없으면 생성. 또, 이미 MAAS 구축할 때 ssh key 등록을 해놨지만 안해두었다면 본인이 사용하는 host의 ssh public key를 등록해둔다.</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-environmentsyaml-파일-수정">2. environments.yaml 파일 수정<a href="#2-environmentsyaml-파일-수정" class="hash-link" aria-label="Direct link to 2. environments.yaml 파일 수정" title="Direct link to 2. environments.yaml 파일 수정">​</a></h3>
<p>Juju를 설치하면 ~/.juju 경로가 몇개의 파일과 함께 자동 생성된다. 만약 없다면 juju init 명령을 실행하면 생성된다. Juju는 yaml로 각 환경에 대한 설정을 사전에 정의해서 사용하기 때문에 ~/.juju/environments.yaml 파일을 수정해야 한다. 아래 그림처럼 maas 항목을 찾아서 세부 설정을 해주면 된다.</p>
<p><a href="http://13.125.231.217/wp-content/uploads/2016/11/juju-environment.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju-environment" src="/assets/images/juju-environment-f9b0cf674f975f370d0fb13cdd565a38.png" width="697" height="564" class="img_ev3q"></a></p>
<p>필수 설정 항목을 정리하면 아래와 같다.</p>
<p>maas-server : MAAS 접근 url</p>
<p>maas-oauth : 과정 1에서 미리 복사해 둔 maas-key를 입력</p>
<p>admin-secret : 문서에 의하면 random pass-phrase라고 하는데 어디에 사용되는지는 모르겠지만 없으면 bootstrap이 진행되지 않으니 임의의 값을 입력해준다.</p>
<p>위의 3개 값은 필수이니 설정하고 저장하면 완료.</p>
<p> </p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-bootstrap-with-no-auto-upgrade-option">3. Bootstrap with no-auto-upgrade option<a href="#3-bootstrap-with-no-auto-upgrade-option" class="hash-link" aria-label="Direct link to 3. Bootstrap with no-auto-upgrade option" title="Direct link to 3. Bootstrap with no-auto-upgrade option">​</a></h3>
<p><strong>(1) Switch environment</strong></p>
<p>environments.yaml 파일을 대충 봤으면 알겠지만 여러가지 환경에 대한 설정을 한 파일에 모두 정의하도록 되어있는데 상황에 따라 선택적으로 환경을 지정할 수 있게 되어있다. 현재 juju가 사용하는 환경으로 지정된 것은 ~/.juju/current-environment 파일에 저장된다. 만약 maas가 기본으로 지정되어 있지 않다면 아래의 command를 실행해야 한다. (environments.yaml 파일에 maas라는 이름을 변경하지 않은 경우. 만약 변경했다면 변경된 이름으로 switch)</p>
<p>[bash]</p>
<p>juju switch maas</p>
<p>[/bash]</p>
<p><strong>(2) Ready node</strong></p>
<p>Juju가 MAAS 대상으로 bootstrap 가능한 node는 ready 상태의 node이다. 당연하겠지만 다른 사용자의 소유로 되어있거나 (allocated) OS가 deploy된 상태인 node에는 이미 다른 용도로 사용중이거나 예정인 것이므로 juju가 관여하지 않고 ready로 남아있는 node 중에 하나를 무작위로 골라서 bootstrap을 하게 되므로 주의해야 한다.</p>
<p><strong>(3) Bootstrap</strong></p>
<p>이제 bootstrap만 하면 되는데 juju 1.25.3에서 진행해보니 거의 마지막 과정에서 Waiting for API to become available이 여러번 반복되며 부분적으로만 bootstrap이 성공한 것으로 완료되는 문제가 있어서 <a href="https://bugs.launchpad.net/juju-core/+bug/1509097" target="_blank" rel="noopener noreferrer">bug report</a>를 찾아봤다. 문서 내용에 의하면 newer version이 필요한 상태로 client에 기록되고 그 정보가 bootstrap machine (juju state server가 될 장비)에 넘어가서 bootstrap machine에서 newer version과의 연결을 계속 시도하는 것 같다. 개선될 bug로 보이는데 어찌되었든 1.25.3에서 그런 문제를 방지하려면 아래처럼 no-auto-upgrade option을 추가해준다. (v option은 verbose.혹시 더 많은 로그를 보고 싶으면 v 대신 debug 옵션을 주면 되겠다.)</p>
<p>[bash]</p>
<p>juju bootstrap -v --no-auto-upgrade</p>
<p>[/bash]</p>
<p>아래 그림과 비슷한 내용이 표시되고 완료된다.</p>
<p><a href="http://13.125.231.217/wp-content/uploads/2016/11/juju-bootstrap.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju-bootstrap" src="/assets/images/juju-bootstrap-aa2c09b1fa3e9751596138ca2cacee07.png" width="704" height="683" class="img_ev3q"></a></p>
<p>bootstrap이 정상으로 완료되고 juju status 명령을 입력해보면 아래 그림처럼 현재 상태가 표시되고,</p>
<p> </p>
<p><a href="http://13.125.231.217/wp-content/uploads/2016/11/juju-status.png" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="juju-status" src="/assets/images/juju-status-39f4488462806c960399bae7951a763d.png" width="682" height="564" class="img_ev3q"></a></p>
<p>혹시 ssh로 접속하고 싶다면 아래의 command를 입력하면 간단히 접속된다.</p>
<p>[bash]</p>
<p># connect to juju machine number &#x27;0&#x27;</p>
<p>juju ssh 0</p>
<p>[/bash]</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/boostrap">boostrap</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/juju">juju</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/maas">maas</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/maas-juju-연결">maas-juju-연결</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/no-auto-upgrade">no-auto-upgrade</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/waiting-for-api-to-become-available">waiting-for-api-to-become-available</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/2016/11/18/wp/mesos-기반에서의-docker-부하-테스트와-모니터링"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Mesos 기반에서의 Docker 부하 테스트와 모니터링</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/2016/11/04/wp/vpn으로-maas-node에-접근하기-위한-route-설정"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">VPN으로 MAAS node에 접근하기 위한 route 설정</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-prerequisites" class="table-of-contents__link toc-highlight">1. Prerequisites</a></li><li><a href="#2-environmentsyaml-파일-수정" class="table-of-contents__link toc-highlight">2. environments.yaml 파일 수정</a></li><li><a href="#3-bootstrap-with-no-auto-upgrade-option" class="table-of-contents__link toc-highlight">3. Bootstrap with no-auto-upgrade option</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>